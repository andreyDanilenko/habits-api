# ðŸŽ“ ÐŸÐ¾Ð»Ð½Ñ‹Ð¹ Ð³Ð°Ð¹Ð´ Ð¿Ð¾ Ð¾Ð±ÑƒÑ‡ÐµÐ½Ð¸ÑŽ Ð¸ Ñ€Ð°Ð·Ð²Ð¸Ñ‚Ð¸ÑŽ ERP ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹

## ðŸ“‹ Ð¡Ð¾Ð´ÐµÑ€Ð¶Ð°Ð½Ð¸Ðµ

1. [ÐŸÐ»Ð°Ð½ Ñ€Ð°Ð·Ð²Ð¸Ñ‚Ð¸Ñ ERP Ð¿Ð¾ Ð¼Ð¾Ð´ÑƒÐ»ÑÐ¼](#Ð¿Ð»Ð°Ð½-Ñ€Ð°Ð·Ð²Ð¸Ñ‚Ð¸Ñ-erp-Ð¿Ð¾-Ð¼Ð¾Ð´ÑƒÐ»ÑÐ¼)
2. [ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ… - Ð¿Ð¾Ð»Ð½Ð¾Ðµ Ñ€ÑƒÐºÐ¾Ð²Ð¾Ð´ÑÑ‚Ð²Ð¾](#Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸-Ð±Ð°Ð·Ñ‹-Ð´Ð°Ð½Ð½Ñ‹Ñ…)
3. [ÐÐ»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ñ Ð¼Ð¾Ð´ÐµÐ»ÑÐ¼Ð¸](#Ð°Ð»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼-Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹-Ñ-Ð¼Ð¾Ð´ÐµÐ»ÑÐ¼Ð¸)
4. [Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÑÐ¼Ð¸](#ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ-Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÑÐ¼Ð¸)
5. [Ð¢Ð°Ð±Ð»Ð¸Ñ†Ñ‹ ÑÐ²ÑÐ·ÐµÐ¹ (Junction Tables)](#Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹-ÑÐ²ÑÐ·ÐµÐ¹)
6. [ÐžÐ±Ñ€Ð°Ñ‚Ð½Ð°Ñ ÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð¾ÑÑ‚ÑŒ](#Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ð°Ñ-ÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð¾ÑÑ‚ÑŒ)
7. [Ð¢Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ - Ð³Ð´Ðµ Ð¸ ÐºÐ°Ðº Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÑÑ‚ÑŒ](#Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸)
8. [Ð¡ÑƒÐ¿ÐµÑ€-Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð¸ Ð¼Ð¾Ð´ÑƒÐ»ÑŒÐ½Ð°Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ð°](#ÑÑƒÐ¿ÐµÑ€-Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ-Ð¸-Ð¼Ð¾Ð´ÑƒÐ»Ð¸)
9. [SQL Ð¼Ð°ÑÑ‚ÐµÑ€-ÐºÐ»Ð°ÑÑ](#sql-Ð¼Ð°ÑÑ‚ÐµÑ€-ÐºÐ»Ð°ÑÑ)
10. [ÐŸÑ€Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ñ‹](#Ð¿Ñ€Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ-Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ñ‹)

---

## ðŸ—ºï¸ ÐŸÐ»Ð°Ð½ Ñ€Ð°Ð·Ð²Ð¸Ñ‚Ð¸Ñ ERP Ð¿Ð¾ Ð¼Ð¾Ð´ÑƒÐ»ÑÐ¼

### Ð­Ñ‚Ð°Ð¿ 1: ÐžÑÐ½Ð¾Ð²Ð° (Ð£Ð¶Ðµ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð¾ âœ…)

#### 1.1. ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ð¸ (Users)
**ÐŸÐ¾Ñ€ÑÐ´Ð¾Ðº Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸:**
1. âœ… Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ `000002_create_users.up.sql`
2. âœ… Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¼Ð¾Ð´ÐµÐ»ÑŒ `internal/model/user.go`
3. âœ… Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ repository `internal/repository/user/repository.go`
4. âœ… Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ service `internal/service/auth/service.go`
5. âœ… Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ handler `internal/handler/auth/handler.go`

**Ð§Ñ‚Ð¾ Ð¸Ð·ÑƒÑ‡Ð¸Ð»Ð¸:**
- Ð‘Ð°Ð·Ð¾Ð²Ð°Ñ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹
- Ð˜Ð½Ð´ÐµÐºÑÑ‹ Ð´Ð»Ñ Ð±Ñ‹ÑÑ‚Ñ€Ð¾Ð³Ð¾ Ð¿Ð¾Ð¸ÑÐºÐ°
- Ð¥ÐµÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð°Ñ€Ð¾Ð»ÐµÐ¹
- JWT Ñ‚Ð¾ÐºÐµÐ½Ñ‹

---

#### 1.2. Workspaces (Ð Ð°Ð±Ð¾Ñ‡Ð¸Ðµ Ð¿Ñ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÑÑ‚Ð²Ð°)
**ÐŸÐ¾Ñ€ÑÐ´Ð¾Ðº Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸:**
1. âœ… ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ñ `000005_create_workspaces.up.sql`
2. âœ… ÐœÐ¾Ð´ÐµÐ»ÑŒ `internal/model/workspace.go`
3. âœ… Repository, Service, Handler

**ÐšÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ñ‹:**
- `owner_id` â†’ ÑÐ²ÑÐ·ÑŒ Ñ users
- Ð¢Ñ€Ð¸Ð³Ð³ÐµÑ€ Ð´Ð»Ñ `updated_at`
- Workspace ÐºÐ°Ðº ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€ Ð´Ð»Ñ Ð¼Ð¾Ð´ÑƒÐ»ÐµÐ¹

---

#### 1.3. User_Workspaces (Ð¡Ð²ÑÐ·ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð¸ workspace)
**ÐŸÐ¾Ñ€ÑÐ´Ð¾Ðº Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸:**
1. âœ… ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ñ `000006_create_user_workspaces.up.sql`
2. âœ… Junction table (Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð° ÑÐ²ÑÐ·ÐµÐ¹)

**Ð§Ñ‚Ð¾ ÑÑ‚Ð¾:**
- ÐœÐ½Ð¾Ð³Ð¸Ðµ-ÐºÐ¾-Ð¼Ð½Ð¾Ð³Ð¸Ð¼ ÑÐ²ÑÐ·ÑŒ
- `UNIQUE(user_id, workspace_id)` - Ð¾Ð´Ð¸Ð½ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð´Ð²Ð°Ð¶Ð´Ñ‹ Ð² Ð¾Ð´Ð½Ð¾Ð¼ workspace
- Ð Ð¾Ð»Ð¸: OWNER, MEMBER, ADMIN

---

### Ð­Ñ‚Ð°Ð¿ 2: ÐŸÐµÑ€Ð²Ñ‹Ð¹ Ð¼Ð¾Ð´ÑƒÐ»ÑŒ - Habits (Ð£Ð¶Ðµ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð¾ âœ…)

**ÐŸÐ¾Ñ€ÑÐ´Ð¾Ðº Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸:**

1. **ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ñ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹:**
   ```sql
   -- 000003_create_habits.up.sql
   CREATE TABLE habits (
       id UUID PRIMARY KEY,
       title VARCHAR(255) NOT NULL,
       user_id UUID NOT NULL,
       workspace_id UUID NOT NULL,
       -- ... Ð¾ÑÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð¿Ð¾Ð»Ñ
   );
   ```

2. **ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ñ ÑÐ²ÑÐ·Ð°Ð½Ð½Ð¾Ð¹ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹:**
   ```sql
   -- 000004_create_habit_completions.up.sql
   CREATE TABLE habit_completions (
       id UUID PRIMARY KEY,
       habit_id UUID NOT NULL,
       user_id UUID NOT NULL,
       date DATE NOT NULL,
       -- ...
   );
   ```

3. **ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ñ ÑÐ²ÑÐ·ÐµÐ¹ (Foreign Keys):**
   ```sql
   -- constraints/01_foreign_keys.up.sql
   ALTER TABLE habits 
   ADD CONSTRAINT fk_habits_user 
   FOREIGN KEY (user_id) REFERENCES users(id);
   ```

4. **ÐœÐ¾Ð´ÐµÐ»Ð¸:**
   - `internal/model/habits.go` - Habit, HabitCompletion, DTOs

5. **Repository:**
   - `internal/repository/habits/repository.go`
   - ÐœÐµÑ‚Ð¾Ð´Ñ‹: List, Create, Update, Delete, Complete, Toggle

6. **Service:**
   - `internal/service/habits/service.go`
   - Ð‘Ð¸Ð·Ð½ÐµÑ-Ð»Ð¾Ð³Ð¸ÐºÐ°, Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ

7. **Handler:**
   - `internal/handler/habits/handler.go`
   - HTTP endpoints

---

### Ð­Ñ‚Ð°Ð¿ 3: Ð’Ñ‚Ð¾Ñ€Ð¾Ð¹ Ð¼Ð¾Ð´ÑƒÐ»ÑŒ - Journal (Ð’ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ)

**ÐŸÐ¾Ñ€ÑÐ´Ð¾Ðº Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸:**

#### Ð¨Ð°Ð³ 1: ÐŸÐ»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ

**Ð’Ð¾Ð¿Ñ€Ð¾ÑÑ‹ Ð´Ð»Ñ ÑÐµÐ±Ñ:**
1. ÐšÐ°ÐºÐ¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ Journal?
   - Ð—Ð°Ð¿Ð¸ÑÐ¸ Ð¿Ð¾ Ð´Ð°Ñ‚Ð°Ð¼
   - Ð¢ÐµÐºÑÑ‚, Ñ‚ÐµÐ³Ð¸, Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ðµ
   - ÐŸÑ€Ð¸Ð²ÑÐ·ÐºÐ° Ðº workspace

2. ÐšÐ°ÐºÐ¸Ðµ ÑÐ²ÑÐ·Ð¸ Ð½ÑƒÐ¶Ð½Ñ‹?
   - Journal â†’ Workspace (1:N)
   - Journal â†’ User (1:N)
   - Journal â†’ Tags (N:M Ñ‡ÐµÑ€ÐµÐ· junction table)

3. ÐšÐ°ÐºÐ¸Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ð½ÑƒÐ¶Ð½Ñ‹?
   - Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð·Ð°Ð¿Ð¸ÑÐ¸
   - ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð¿Ð¾ Ð´Ð°Ñ‚Ðµ
   - ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ
   - Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ
   - ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾ Ñ‚ÐµÐ³Ð°Ð¼

#### Ð¨Ð°Ð³ 2: Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹

**ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ñ 1: ÐžÑÐ½Ð¾Ð²Ð½Ð°Ñ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð°**
```sql
-- 000010_create_journals.up.sql
CREATE TABLE journals (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL,
    workspace_id UUID NOT NULL,
    date DATE NOT NULL,
    title VARCHAR(255),
    content TEXT NOT NULL,
    mood VARCHAR(50), -- 'happy', 'sad', 'neutral'
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP NOT NULL DEFAULT NOW(),
    
    -- ÐžÐ´Ð½Ð° Ð·Ð°Ð¿Ð¸ÑÑŒ Ð½Ð° Ð´ÐµÐ½ÑŒ Ð´Ð»Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð² workspace
    UNIQUE(user_id, workspace_id, date)
);

CREATE INDEX idx_journals_user_workspace ON journals(user_id, workspace_id);
CREATE INDEX idx_journals_date ON journals(date);
CREATE INDEX idx_journals_created_at ON journals(created_at DESC);
```

**ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ñ 2: Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° Ñ‚ÐµÐ³Ð¾Ð² (ÐµÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð°)**
```sql
-- 000011_create_journal_tags.up.sql
CREATE TABLE journal_tags (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(100) NOT NULL UNIQUE,
    color VARCHAR(50) DEFAULT '#3B82F6',
    created_at TIMESTAMP NOT NULL DEFAULT NOW()
);
```

**ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ñ 3: Junction table Ð´Ð»Ñ ÑÐ²ÑÐ·Ð¸ Journal â†” Tags**
```sql
-- 000012_create_journal_tag_links.up.sql
CREATE TABLE journal_tag_links (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    journal_id UUID NOT NULL,
    tag_id UUID NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    
    UNIQUE(journal_id, tag_id)
);

CREATE INDEX idx_journal_tag_links_journal ON journal_tag_links(journal_id);
CREATE INDEX idx_journal_tag_links_tag ON journal_tag_links(tag_id);
```

**ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ñ 4: Foreign Keys**
```sql
-- constraints/03_journal_foreign_keys.up.sql
ALTER TABLE journals 
ADD CONSTRAINT fk_journals_user 
FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE;

ALTER TABLE journals 
ADD CONSTRAINT fk_journals_workspace 
FOREIGN KEY (workspace_id) REFERENCES workspaces(id) ON DELETE CASCADE;

ALTER TABLE journal_tag_links 
ADD CONSTRAINT fk_journal_tag_links_journal 
FOREIGN KEY (journal_id) REFERENCES journals(id) ON DELETE CASCADE;

ALTER TABLE journal_tag_links 
ADD CONSTRAINT fk_journal_tag_links_tag 
FOREIGN KEY (tag_id) REFERENCES journal_tags(id) ON DELETE CASCADE;
```

#### Ð¨Ð°Ð³ 3: ÐœÐ¾Ð´ÐµÐ»Ð¸

```go
// internal/model/journal.go
package model

type Journal struct {
    ID          string   `json:"id" db:"id"`
    UserID      string   `json:"userId" db:"user_id"`
    WorkspaceID string   `json:"workspaceId" db:"workspace_id"`
    Date        string   `json:"date" db:"date"` // "2006-01-02"
    Title       string   `json:"title,omitempty" db:"title"`
    Content     string   `json:"content" db:"content"`
    Mood        string   `json:"mood,omitempty" db:"mood"`
    Tags        []Tag    `json:"tags,omitempty"` // Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÑ‚ÑÑ Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ñ‹Ð¼ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð¼
    CreatedAt   string   `json:"createdAt" db:"created_at"`
    UpdatedAt   string   `json:"updatedAt" db:"updated_at"`
}

type JournalTag struct {
    ID        string `json:"id" db:"id"`
    Name      string `json:"name" db:"name"`
    Color     string `json:"color" db:"color"`
    CreatedAt string `json:"createdAt" db:"created_at"`
}

type CreateJournalDto struct {
    Date    string   `json:"date" binding:"required"`
    Title   string   `json:"title,omitempty"`
    Content string   `json:"content" binding:"required"`
    Mood    string   `json:"mood,omitempty"`
    TagIDs  []string `json:"tagIds,omitempty"`
}
```

#### Ð¨Ð°Ð³ 4: Repository

```go
// internal/repository/journal/repository.go
package journal

import (
    "context"
    "database/sql"
    "time"
    "backend/internal/model"
    "github.com/google/uuid"
)

type Repository struct {
    db *sql.DB
}

func NewRepository(db *sql.DB) *Repository {
    return &Repository{db: db}
}

func (r *Repository) Create(ctx context.Context, dto model.CreateJournalDto, userID, workspaceID uuid.UUID) (*model.Journal, error) {
    // ÐÐ°Ñ‡Ð¸Ð½Ð°ÐµÐ¼ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸ÑŽ Ð´Ð»Ñ Ð°Ñ‚Ð¾Ð¼Ð°Ñ€Ð½Ð¾ÑÑ‚Ð¸
    tx, err := r.db.BeginTx(ctx, nil)
    if err != nil {
        return nil, fmt.Errorf("failed to begin transaction: %w", err)
    }
    defer tx.Rollback()
    
    // 1. Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð·Ð°Ð¿Ð¸ÑÑŒ Ð¶ÑƒÑ€Ð½Ð°Ð»Ð°
    journalID := uuid.New()
    now := time.Now()
    
    query := `
        INSERT INTO journals (
            id, user_id, workspace_id, date, title, content, mood, created_at, updated_at
        ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9)
        RETURNING id, user_id, workspace_id, date, title, content, mood, created_at, updated_at
    `
    
    var journal model.Journal
    var createdAt, updatedAt time.Time
    
    err = tx.QueryRowContext(ctx, query,
        journalID, userID, workspaceID, dto.Date, dto.Title, dto.Content, dto.Mood, now, now,
    ).Scan(
        &journal.ID, &journal.UserID, &journal.WorkspaceID, &journal.Date,
        &journal.Title, &journal.Content, &journal.Mood, &createdAt, &updatedAt,
    )
    if err != nil {
        return nil, fmt.Errorf("failed to create journal: %w", err)
    }
    
    // 2. Ð¡Ð²ÑÐ·Ñ‹Ð²Ð°ÐµÐ¼ Ñ‚ÐµÐ³Ð¸ (ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ)
    if len(dto.TagIDs) > 0 {
        for _, tagIDStr := range dto.TagIDs {
            tagID, err := uuid.Parse(tagIDStr)
            if err != nil {
                continue
            }
            
            _, err = tx.ExecContext(ctx,
                "INSERT INTO journal_tag_links (id, journal_id, tag_id, created_at) VALUES ($1, $2, $3, $4)",
                uuid.New(), journalID, tagID, now,
            )
            if err != nil {
                // Ð›Ð¾Ð³Ð¸Ñ€ÑƒÐµÐ¼ Ð¾ÑˆÐ¸Ð±ÐºÑƒ, Ð½Ð¾ Ð½Ðµ Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð°ÐµÐ¼ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸ÑŽ
                log.Printf("Failed to link tag %s: %v", tagIDStr, err)
            }
        }
    }
    
    // ÐšÐ¾Ð¼Ð¼Ð¸Ñ‚Ð¸Ð¼ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸ÑŽ
    if err := tx.Commit(); err != nil {
        return nil, fmt.Errorf("failed to commit transaction: %w", err)
    }
    
    journal.CreatedAt = createdAt.Format(time.RFC3339)
    journal.UpdatedAt = updatedAt.Format(time.RFC3339)
    
    return &journal, nil
}

func (r *Repository) GetByDate(ctx context.Context, userID, workspaceID uuid.UUID, date time.Time) (*model.Journal, error) {
    query := `
        SELECT id, user_id, workspace_id, date, title, content, mood, created_at, updated_at
        FROM journals
        WHERE user_id = $1 AND workspace_id = $2 AND date = $3
    `
    
    var journal model.Journal
    var createdAt, updatedAt time.Time
    
    err := r.db.QueryRowContext(ctx, query, userID, workspaceID, date).Scan(
        &journal.ID, &journal.UserID, &journal.WorkspaceID, &journal.Date,
        &journal.Title, &journal.Content, &journal.Mood, &createdAt, &updatedAt,
    )
    if err == sql.ErrNoRows {
        return nil, nil
    }
    if err != nil {
        return nil, fmt.Errorf("failed to get journal: %w", err)
    }
    
    journal.CreatedAt = createdAt.Format(time.RFC3339)
    journal.UpdatedAt = updatedAt.Format(time.RFC3339)
    
    // Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÐ¼ Ñ‚ÐµÐ³Ð¸ Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ñ‹Ð¼ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð¼
    tags, _ := r.getTagsForJournal(ctx, journal.ID)
    journal.Tags = tags
    
    return &journal, nil
}

func (r *Repository) getTagsForJournal(ctx context.Context, journalID uuid.UUID) ([]model.JournalTag, error) {
    query := `
        SELECT t.id, t.name, t.color, t.created_at
        FROM journal_tags t
        INNER JOIN journal_tag_links l ON t.id = l.tag_id
        WHERE l.journal_id = $1
        ORDER BY t.name
    `
    
    rows, err := r.db.QueryContext(ctx, query, journalID)
    if err != nil {
        return nil, err
    }
    defer rows.Close()
    
    var tags []model.JournalTag
    for rows.Next() {
        var tag model.JournalTag
        var createdAt time.Time
        err := rows.Scan(&tag.ID, &tag.Name, &tag.Color, &createdAt)
        if err != nil {
            continue
        }
        tag.CreatedAt = createdAt.Format(time.RFC3339)
        tags = append(tags, tag)
    }
    
    return tags, nil
}
```

---

### Ð­Ñ‚Ð°Ð¿ 4: ÐŸÐ¾ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ Ð¼Ð¾Ð´ÑƒÐ»Ð¸

**Ð¨Ð°Ð±Ð»Ð¾Ð½ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð½Ð¾Ð²Ð¾Ð³Ð¾ Ð¼Ð¾Ð´ÑƒÐ»Ñ:**

1. **ÐŸÐ»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ:**
   - ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ ÑÑƒÑ‰Ð½Ð¾ÑÑ‚Ð¸
   - ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ ÑÐ²ÑÐ·Ð¸
   - ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸

2. **ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸:**
   - ÐžÑÐ½Ð¾Ð²Ð½Ð°Ñ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð°
   - Ð¡Ð²ÑÐ·Ð°Ð½Ð½Ñ‹Ðµ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹
   - Junction tables (ÐµÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ñ‹)
   - Foreign keys
   - Ð˜Ð½Ð´ÐµÐºÑÑ‹

3. **ÐœÐ¾Ð´ÐµÐ»Ð¸:**
   - ÐžÑÐ½Ð¾Ð²Ð½Ð°Ñ Ð¼Ð¾Ð´ÐµÐ»ÑŒ
   - DTOs (Create, Update)
   - Response Ð¼Ð¾Ð´ÐµÐ»Ð¸

4. **Repository:**
   - CRUD Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸
   - Ð¡Ð»Ð¾Ð¶Ð½Ñ‹Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹
   - Ð¢Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ (ÐµÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ñ‹)

5. **Service:**
   - Ð‘Ð¸Ð·Ð½ÐµÑ-Ð»Ð¾Ð³Ð¸ÐºÐ°
   - Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ
   - ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº

6. **Handler:**
   - HTTP endpoints
   - Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²
   - ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð²

---

## ðŸ—„ï¸ ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…

### Ð§Ñ‚Ð¾ Ñ‚Ð°ÐºÐ¾Ðµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ñ?

**ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ñ** - ÑÑ‚Ð¾ Ð²ÐµÑ€ÑÐ¸Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð¾Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ….

**ÐŸÑ€Ð¸Ð½Ñ†Ð¸Ð¿Ñ‹:**
- âœ… ÐšÐ°Ð¶Ð´Ð°Ñ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ñ Ð¸Ð¼ÐµÐµÑ‚ Ð½Ð¾Ð¼ÐµÑ€ (000001, 000002, ...)
- âœ… ÐšÐ°Ð¶Ð´Ð°Ñ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ñ Ð¸Ð¼ÐµÐµÑ‚ `.up.sql` (Ð¿Ñ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ) Ð¸ `.down.sql` (Ð¾Ñ‚ÐºÐ°Ñ‚Ð¸Ñ‚ÑŒ)
- âœ… ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÑÑŽÑ‚ÑÑ Ð¿Ð¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾
- âœ… ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ Ð½Ðµ Ð¸Ð·Ð¼ÐµÐ½ÑÑŽÑ‚ÑÑ Ð¿Ð¾ÑÐ»Ðµ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð² production

---

### Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸

#### Ð‘Ð°Ð·Ð¾Ð²Ñ‹Ð¹ ÑˆÐ°Ð±Ð»Ð¾Ð½

```sql
-- 000XXX_create_table_name.up.sql
CREATE TABLE table_name (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    -- Ð¿Ð¾Ð»Ñ
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP NOT NULL DEFAULT NOW()
);

-- Ð˜Ð½Ð´ÐµÐºÑÑ‹
CREATE INDEX idx_table_name_field ON table_name(field);

-- ÐšÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸ (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾, Ð½Ð¾ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ)
COMMENT ON TABLE table_name IS 'ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹';
COMMENT ON COLUMN table_name.field IS 'ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð¿Ð¾Ð»Ñ';
```

```sql
-- 000XXX_create_table_name.down.sql
DROP TABLE IF EXISTS table_name;
```

---

### Ð¢Ð¸Ð¿Ñ‹ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹

#### 1. Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹

**ÐŸÑ€Ð¸Ð¼ÐµÑ€:**
```sql
-- 000010_create_products.up.sql
CREATE TABLE products (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(255) NOT NULL,
    description TEXT,
    price DECIMAL(10, 2) NOT NULL,
    workspace_id UUID NOT NULL,
    user_id UUID NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP NOT NULL DEFAULT NOW()
);

CREATE INDEX idx_products_workspace ON products(workspace_id);
CREATE INDEX idx_products_user ON products(user_id);
CREATE INDEX idx_products_created_at ON products(created_at DESC);
```

**Down Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ñ:**
```sql
-- 000010_create_products.down.sql
DROP TABLE IF EXISTS products;
```

---

#### 2. Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»Ñ

**ÐŸÑ€Ð¸Ð¼ÐµÑ€:**
```sql
-- 000011_add_status_to_products.up.sql
ALTER TABLE products 
ADD COLUMN status VARCHAR(50) DEFAULT 'active';

CREATE INDEX idx_products_status ON products(status);

COMMENT ON COLUMN products.status IS 'Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð°: active, inactive, archived';
```

**Down Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ñ:**
```sql
-- 000011_add_status_to_products.down.sql
ALTER TABLE products DROP COLUMN IF EXISTS status;
```

---

#### 3. Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ñ‚Ð¸Ð¿Ð° Ð¿Ð¾Ð»Ñ

**âš ï¸ Ð’ÐÐ˜ÐœÐÐÐ˜Ð•:** Ð­Ñ‚Ð¾ Ð¾Ð¿Ð°ÑÐ½Ð°Ñ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ñ! ÐÑƒÐ¶Ð½Ð° Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ð°Ñ ÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð¾ÑÑ‚ÑŒ.

**Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ñ‹Ð¹ ÑÐ¿Ð¾ÑÐ¾Ð±:**
```sql
-- 000012_change_price_type.up.sql
-- Ð¨Ð°Ð³ 1: Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð½Ð¾Ð²Ð¾Ðµ Ð¿Ð¾Ð»Ðµ
ALTER TABLE products 
ADD COLUMN price_new DECIMAL(12, 2);

-- Ð¨Ð°Ð³ 2: ÐšÐ¾Ð¿Ð¸Ñ€ÑƒÐµÐ¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ñ Ð¿Ñ€ÐµÐ¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼
UPDATE products 
SET price_new = CAST(price AS DECIMAL(12, 2));

-- Ð¨Ð°Ð³ 3: Ð£Ð´Ð°Ð»ÑÐµÐ¼ ÑÑ‚Ð°Ñ€Ð¾Ðµ Ð¿Ð¾Ð»Ðµ
ALTER TABLE products DROP COLUMN price;

-- Ð¨Ð°Ð³ 4: ÐŸÐµÑ€ÐµÐ¸Ð¼ÐµÐ½Ð¾Ð²Ñ‹Ð²Ð°ÐµÐ¼ Ð½Ð¾Ð²Ð¾Ðµ Ð¿Ð¾Ð»Ðµ
ALTER TABLE products RENAME COLUMN price_new TO price;

-- Ð¨Ð°Ð³ 5: Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ NOT NULL (ÐµÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð¾)
ALTER TABLE products ALTER COLUMN price SET NOT NULL;
```

**Down Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ñ:**
```sql
-- 000012_change_price_type.down.sql
-- ÐžÐ±Ñ€Ð°Ñ‚Ð½Ð°Ñ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ñ
ALTER TABLE products 
ADD COLUMN price_old VARCHAR(50);

UPDATE products 
SET price_old = CAST(price AS VARCHAR(50));

ALTER TABLE products DROP COLUMN price;
ALTER TABLE products RENAME COLUMN price_old TO price;
```

---

#### 4. Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Foreign Key

**ÐŸÑ€Ð¸Ð¼ÐµÑ€:**
```sql
-- 000013_add_product_category_fk.up.sql
-- Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð¿Ð¾Ð»Ðµ (ÐµÑÐ»Ð¸ ÐµÐ³Ð¾ Ð½ÐµÑ‚)
ALTER TABLE products 
ADD COLUMN category_id UUID;

-- Ð—Ð°Ñ‚ÐµÐ¼ Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Foreign Key
ALTER TABLE products 
ADD CONSTRAINT fk_products_category 
FOREIGN KEY (category_id) REFERENCES categories(id) ON DELETE SET NULL;

-- Ð˜Ð½Ð´ÐµÐºÑ Ð´Ð»Ñ Foreign Key (ÑƒÑÐºÐ¾Ñ€ÑÐµÑ‚ JOIN)
CREATE INDEX idx_products_category_id ON products(category_id);
```

**Down Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ñ:**
```sql
-- 000013_add_product_category_fk.down.sql
ALTER TABLE products DROP CONSTRAINT IF EXISTS fk_products_category;
ALTER TABLE products DROP COLUMN IF EXISTS category_id;
```

---

#### 5. Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Junction Table

**ÐŸÑ€Ð¸Ð¼ÐµÑ€:**
```sql
-- 000014_create_product_tags.up.sql
CREATE TABLE product_tags (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    product_id UUID NOT NULL,
    tag_id UUID NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    
    -- ÐŸÑ€ÐµÐ´Ð¾Ñ‚Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ Ð´ÑƒÐ±Ð»Ð¸ÐºÐ°Ñ‚Ñ‹
    UNIQUE(product_id, tag_id)
);

-- Foreign Keys
ALTER TABLE product_tags 
ADD CONSTRAINT fk_product_tags_product 
FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE;

ALTER TABLE product_tags 
ADD CONSTRAINT fk_product_tags_tag 
FOREIGN KEY (tag_id) REFERENCES tags(id) ON DELETE CASCADE;

-- Ð˜Ð½Ð´ÐµÐºÑÑ‹ Ð´Ð»Ñ Ð±Ñ‹ÑÑ‚Ñ€Ð¾Ð³Ð¾ Ð¿Ð¾Ð¸ÑÐºÐ° Ð² Ð¾Ð±Ðµ ÑÑ‚Ð¾Ñ€Ð¾Ð½Ñ‹
CREATE INDEX idx_product_tags_product ON product_tags(product_id);
CREATE INDEX idx_product_tags_tag ON product_tags(tag_id);
```

**Down Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ñ:**
```sql
-- 000014_create_product_tags.down.sql
DROP TABLE IF EXISTS product_tags;
```

---

#### 6. Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… (Seed)

**ÐŸÑ€Ð¸Ð¼ÐµÑ€:**
```sql
-- 000015_seed_default_tags.up.sql
INSERT INTO tags (id, name, color, created_at) VALUES
    (gen_random_uuid(), 'Ð’Ð°Ð¶Ð½Ð¾Ðµ', '#EF4444', NOW()),
    (gen_random_uuid(), 'Ð Ð°Ð±Ð¾Ñ‚Ð°', '#3B82F6', NOW()),
    (gen_random_uuid(), 'Ð›Ð¸Ñ‡Ð½Ð¾Ðµ', '#10B981', NOW())
ON CONFLICT DO NOTHING;
```

**Down Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ñ:**
```sql
-- 000015_seed_default_tags.down.sql
DELETE FROM tags WHERE name IN ('Ð’Ð°Ð¶Ð½Ð¾Ðµ', 'Ð Ð°Ð±Ð¾Ñ‚Ð°', 'Ð›Ð¸Ñ‡Ð½Ð¾Ðµ');
```

---

### ÐŸÐ¾Ñ€ÑÐ´Ð¾Ðº Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹

**Ð’Ð°Ð¶Ð½Ð¾:** ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÑÑŽÑ‚ÑÑ Ð² Ð¿Ð¾Ñ€ÑÐ´ÐºÐµ Ð½Ð¾Ð¼ÐµÑ€Ð¾Ð²!

```
000001 â†’ 000002 â†’ 000003 â†’ ... â†’ 000010 â†’ 000011
```

**Ð•ÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð¾ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ Ð¼ÐµÐ¶Ð´Ñƒ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ð¼Ð¸:**

âŒ **ÐÐ•ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐž:**
```
000001, 000002, 000003, 000003.5 â† ÐÐ• Ð”Ð•Ð›ÐÐ™Ð¢Ð• Ð¢ÐÐš!
```

âœ… **ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐž:**
```
000001, 000002, 000003, 000004 (Ð½Ð¾Ð²Ð°Ñ), 000005 (Ð¿ÐµÑ€ÐµÐ¸Ð¼ÐµÐ½Ð¾Ð²Ð°Ñ‚ÑŒ ÑÑ‚Ð°Ñ€ÑƒÑŽ 000003)
```

**Ð˜Ð»Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð´ÐµÑÑÑ‚Ð¸Ñ‡Ð½Ñ‹Ðµ Ð½Ð¾Ð¼ÐµÑ€Ð°:**
```
000001, 000002, 000003, 000003_1, 000003_2, 000004
```

---

### ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ð² Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑÑ…

**ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°:** ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ñ ÑƒÐ¿Ð°Ð»Ð° Ð¿Ð¾ÑÐµÑ€ÐµÐ´Ð¸Ð½Ðµ

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ:** Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ Ð² Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑÑ… (PostgreSQL Ð´ÐµÐ»Ð°ÐµÑ‚ ÑÑ‚Ð¾ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸)

```sql
-- PostgreSQL Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¾Ð±Ð¾Ñ€Ð°Ñ‡Ð¸Ð²Ð°ÐµÑ‚ ÐºÐ°Ð¶Ð´ÑƒÑŽ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ Ð² Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸ÑŽ
-- Ð•ÑÐ»Ð¸ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ ÑƒÐ¿Ð°Ð»Ð¾ - Ð²ÑÐµ Ð¾Ñ‚ÐºÐ°Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ÑÑ

BEGIN; -- Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸
CREATE TABLE products (...);
CREATE INDEX ...;
-- Ð•ÑÐ»Ð¸ Ð·Ð´ÐµÑÑŒ Ð¾ÑˆÐ¸Ð±ÐºÐ° - Ð²ÑÐµ Ð¾Ñ‚ÐºÐ°Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ÑÑ
COMMIT; -- Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸
```

**ÐÐ¾ Ð´Ð»Ñ Ð½ÐµÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ñ… Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¹ Ð½ÑƒÐ¶ÐµÐ½ ÑÐ²Ð½Ñ‹Ð¹ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŒ:**

```sql
-- 000016_add_column_with_default.up.sql
-- ÐÐµÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ð½Ðµ Ð¼Ð¾Ð³ÑƒÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð² Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, CREATE INDEX CONCURRENTLY)
-- ÐÐ¾ Ð´Ð»Ñ Ð¾Ð±Ñ‹Ñ‡Ð½Ñ‹Ñ… Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¹ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚

ALTER TABLE products ADD COLUMN new_field VARCHAR(100);
UPDATE products SET new_field = 'default' WHERE new_field IS NULL;
ALTER TABLE products ALTER COLUMN new_field SET NOT NULL;
```

---

### ÐžÑ‚ÐºÐ°Ñ‚ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹

**ÐšÐ¾Ð¼Ð°Ð½Ð´Ð°:**
```bash
# ÐžÑ‚ÐºÐ°Ñ‚Ð¸Ñ‚ÑŒ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÑŽÑŽ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ
migrate -path ./migrations -database "postgres://..." down 1

# ÐžÑ‚ÐºÐ°Ñ‚Ð¸Ñ‚ÑŒ 3 Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸
migrate -path ./migrations -database "postgres://..." down 3

# ÐžÑ‚ÐºÐ°Ñ‚Ð¸Ñ‚ÑŒ Ð²ÑÐµ Ð´Ð¾ Ð²ÐµÑ€ÑÐ¸Ð¸ 000010
migrate -path ./migrations -database "postgres://..." down 10
```

**âš ï¸ Ð’ÐÐ˜ÐœÐÐÐ˜Ð•:** Ð’ production Ð¾Ñ‚ÐºÐ°Ñ‚Ñ‹Ð²Ð°Ð¹Ñ‚Ðµ Ð¾ÑÑ‚Ð¾Ñ€Ð¾Ð¶Ð½Ð¾! Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ, Ñ‡Ñ‚Ð¾:
1. ÐÐµÑ‚ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ… Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
2. Ð¡Ð´ÐµÐ»Ð°Ð»Ð¸ backup Ð‘Ð”
3. ÐŸÐ¾Ð½Ð¸Ð¼Ð°ÐµÑ‚Ðµ Ð¿Ð¾ÑÐ»ÐµÐ´ÑÑ‚Ð²Ð¸Ñ

---

### Best Practices Ð´Ð»Ñ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹

1. **Ð’ÑÐµÐ³Ð´Ð° ÑÐ¾Ð·Ð´Ð°Ð²Ð°Ð¹Ñ‚Ðµ `.down.sql`**
   - Ð”Ð°Ð¶Ðµ ÐµÑÐ»Ð¸ ÐºÐ°Ð¶ÐµÑ‚ÑÑ, Ñ‡Ñ‚Ð¾ Ð¾Ñ‚ÐºÐ°Ñ‚ Ð½Ðµ Ð½ÑƒÐ¶ÐµÐ½
   - ÐœÐ¾Ð¶ÐµÑ‚ Ð¿Ð¾Ð½Ð°Ð´Ð¾Ð±Ð¸Ñ‚ÑŒÑÑ Ð´Ð»Ñ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸

2. **Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾**
   ```bash
   # ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ
   migrate up
   # ÐžÑ‚ÐºÐ°Ñ‚Ð¸Ñ‚ÑŒ
   migrate down 1
   # ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ ÑÐ½Ð¾Ð²Ð°
   migrate up
   ```

3. **Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸**
   ```sql
   COMMENT ON TABLE products IS 'Ð¢Ð¾Ð²Ð°Ñ€Ñ‹ Ð² ÑÐ¸ÑÑ‚ÐµÐ¼Ðµ';
   COMMENT ON COLUMN products.price IS 'Ð¦ÐµÐ½Ð° Ð² Ñ€ÑƒÐ±Ð»ÑÑ…';
   ```

4. **Ð˜Ð¼ÐµÐ½ÑƒÐ¹Ñ‚Ðµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ Ð¿Ð¾Ð½ÑÑ‚Ð½Ð¾**
   ```
   âœ… 000010_create_products.up.sql
   âœ… 000011_add_status_to_products.up.sql
   âŒ 000010_migration.up.sql
   âŒ 000011_fix.up.sql
   ```

5. **Ð Ð°Ð·Ð´ÐµÐ»ÑÐ¹Ñ‚Ðµ Ð±Ð¾Ð»ÑŒÑˆÐ¸Ðµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸**
   ```
   âŒ ÐžÐ´Ð½Ð° Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ñ ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ 10 Ñ‚Ð°Ð±Ð»Ð¸Ñ†
   âœ… 10 Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹, ÐºÐ°Ð¶Ð´Ð°Ñ ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ Ð¾Ð´Ð½Ñƒ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ
   ```

6. **ÐÐµ Ð¸Ð·Ð¼ÐµÐ½ÑÐ¹Ñ‚Ðµ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð½Ñ‹Ðµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸**
   ```
   âŒ Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ 000010 Ð¿Ð¾ÑÐ»Ðµ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð² production
   âœ… Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð½Ð¾Ð²ÑƒÑŽ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ 000020 Ð´Ð»Ñ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ
   ```

---

## ðŸ”„ ÐÐ»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ñ Ð¼Ð¾Ð´ÐµÐ»ÑÐ¼Ð¸

### Ð¨Ð°Ð³ 1: Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð½Ð¾Ð²Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸

#### 1.1. ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ Ð´Ð°Ð½Ð½Ñ‹Ñ…

**Ð’Ð¾Ð¿Ñ€Ð¾ÑÑ‹:**
- ÐšÐ°ÐºÐ¸Ðµ Ð¿Ð¾Ð»Ñ Ð½ÑƒÐ¶Ð½Ñ‹?
- ÐšÐ°ÐºÐ¸Ðµ Ð¿Ð¾Ð»Ñ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ (NOT NULL)?
- ÐšÐ°ÐºÐ¸Ðµ Ð¿Ð¾Ð»Ñ Ð¼Ð¾Ð³ÑƒÑ‚ Ð±Ñ‹Ñ‚ÑŒ NULL?
- ÐšÐ°ÐºÐ¸Ðµ Ñ‚Ð¸Ð¿Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ?

**ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ:**
```
ÐœÐ¾Ð´ÐµÐ»ÑŒ: Task (Ð—Ð°Ð´Ð°Ñ‡Ð°)
ÐŸÐ¾Ð»Ñ:
  - id (UUID) - Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ
  - title (string) - Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ
  - description (text) - Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾Ðµ
  - status (enum: todo, in_progress, done) - Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ, default: todo
  - priority (int: 1-5) - Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾Ðµ
  - due_date (date) - Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾Ðµ
  - user_id (UUID) - Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ
  - workspace_id (UUID) - Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ
  - created_at (timestamp) - Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ
  - updated_at (timestamp) - Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ
```

#### 1.2. Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ

```sql
-- 000020_create_tasks.up.sql
CREATE TABLE tasks (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    title VARCHAR(255) NOT NULL,
    description TEXT,
    status VARCHAR(50) NOT NULL DEFAULT 'todo',
    priority INTEGER CHECK (priority >= 1 AND priority <= 5),
    due_date DATE,
    user_id UUID NOT NULL,
    workspace_id UUID NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP NOT NULL DEFAULT NOW(),
    
    -- ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ð°Ñ‚ÑƒÑÐ°
    CHECK (status IN ('todo', 'in_progress', 'done'))
);

CREATE INDEX idx_tasks_user_workspace ON tasks(user_id, workspace_id);
CREATE INDEX idx_tasks_status ON tasks(status);
CREATE INDEX idx_tasks_due_date ON tasks(due_date);
```

#### 1.3. Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Go Ð¼Ð¾Ð´ÐµÐ»ÑŒ

```go
// internal/model/task.go
package model

type TaskStatus string

const (
    TaskStatusTodo       TaskStatus = "todo"
    TaskStatusInProgress TaskStatus = "in_progress"
    TaskStatusDone       TaskStatus = "done"
)

type Task struct {
    ID          string     `json:"id" db:"id"`
    Title       string     `json:"title" db:"title"`
    Description string     `json:"description,omitempty" db:"description"`
    Status      TaskStatus `json:"status" db:"status"`
    Priority    *int       `json:"priority,omitempty" db:"priority"` // Ð£ÐºÐ°Ð·Ð°Ñ‚ÐµÐ»ÑŒ Ð´Ð»Ñ NULL
    DueDate     string     `json:"dueDate,omitempty" db:"due_date"`
    UserID      string     `json:"userId" db:"user_id"`
    WorkspaceID string     `json:"workspaceId" db:"workspace_id"`
    CreatedAt   string     `json:"createdAt" db:"created_at"`
    UpdatedAt   string     `json:"updatedAt" db:"updated_at"`
}

type CreateTaskDto struct {
    Title       string  `json:"title" binding:"required"`
    Description string  `json:"description,omitempty"`
    Status      string  `json:"status,omitempty"`
    Priority    *int    `json:"priority,omitempty"`
    DueDate     string  `json:"dueDate,omitempty"`
}

type UpdateTaskDto struct {
    Title       *string `json:"title,omitempty"`
    Description *string `json:"description,omitempty"`
    Status      *string `json:"status,omitempty"`
    Priority    *int    `json:"priority,omitempty"`
    DueDate     *string `json:"dueDate,omitempty"`
}
```

**Ð’Ð°Ð¶Ð½Ñ‹Ðµ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ñ‹:**
- Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ `*int`, `*string` Ð´Ð»Ñ Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ñ… Ð¿Ð¾Ð»ÐµÐ¹ (NULL Ð² Ð‘Ð”)
- Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ `omitempty` Ð² JSON Ñ‚ÐµÐ³Ð°Ñ…
- Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ `db` Ñ‚ÐµÐ³Ð¸ Ð´Ð»Ñ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ñ Ñ ÐºÐ¾Ð»Ð¾Ð½ÐºÐ°Ð¼Ð¸ Ð‘Ð”

---

### Ð¨Ð°Ð³ 2: ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰ÐµÐ¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸

#### 2.1. Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð½Ð¾Ð²Ð¾Ð³Ð¾ Ð¿Ð¾Ð»Ñ

**ÐÐ»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼:**

1. **Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ:**
   ```sql
   -- 000021_add_assignee_to_tasks.up.sql
   ALTER TABLE tasks 
   ADD COLUMN assignee_id UUID;
   
   CREATE INDEX idx_tasks_assignee ON tasks(assignee_id);
   
   COMMENT ON COLUMN tasks.assignee_id IS 'ID Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ, ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð¼Ñƒ Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð° Ð·Ð°Ð´Ð°Ñ‡Ð°';
   ```

2. **ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð¼Ð¾Ð´ÐµÐ»ÑŒ:**
   ```go
   type Task struct {
       // ... ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ðµ Ð¿Ð¾Ð»Ñ
       AssigneeID *string `json:"assigneeId,omitempty" db:"assignee_id"` // ÐÐ¾Ð²Ð¾Ðµ Ð¿Ð¾Ð»Ðµ
   }
   ```

3. **ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ DTOs:**
   ```go
   type CreateTaskDto struct {
       // ... ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ðµ Ð¿Ð¾Ð»Ñ
       AssigneeID *string `json:"assigneeId,omitempty"` // ÐÐ¾Ð²Ð¾Ðµ Ð¿Ð¾Ð»Ðµ
   }
   ```

4. **ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Repository:**
   ```go
   func (r *Repository) Create(ctx context.Context, dto model.CreateTaskDto, ...) {
       query := `
           INSERT INTO tasks (..., assignee_id, ...)
           VALUES (..., $N, ...)
       `
       // Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ assignee_id Ð² Scan
   }
   ```

5. **ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Service Ð¸ Handler** (ÐµÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð¾)

---

#### 2.2. Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»Ñ

**âš ï¸ Ð’ÐÐ˜ÐœÐÐÐ˜Ð•:** Ð­Ñ‚Ð¾ breaking change!

**ÐÐ»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼:**

1. **Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ Ð´Ð»Ñ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ:**
   ```sql
   -- 000022_remove_priority_from_tasks.up.sql
   ALTER TABLE tasks DROP COLUMN IF EXISTS priority;
   ```

2. **ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð¼Ð¾Ð´ÐµÐ»ÑŒ:**
   ```go
   type Task struct {
       // ... ÑƒÐ±Ñ€Ð°Ñ‚ÑŒ Priority
   }
   ```

3. **ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð²ÑÐµ Ð¼ÐµÑÑ‚Ð° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ**

**âš ï¸ Ð”Ð»Ñ Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ð¾Ð¹ ÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð¾ÑÑ‚Ð¸:**
- Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð¿Ð¾Ð¼ÐµÑ‚Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð»Ðµ ÐºÐ°Ðº deprecated
- ÐŸÐ¾Ð´Ð¾Ð¶Ð´Ð°Ñ‚ÑŒ Ð²ÐµÑ€ÑÐ¸ÑŽ
- Ð—Ð°Ñ‚ÐµÐ¼ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ

---

#### 2.3. Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ñ‚Ð¸Ð¿Ð° Ð¿Ð¾Ð»Ñ

**ÐŸÑ€Ð¸Ð¼ÐµÑ€: Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ status Ñ VARCHAR Ð½Ð° ENUM**

**Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ñ‹Ð¹ ÑÐ¿Ð¾ÑÐ¾Ð±:**

1. **Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð½Ð¾Ð²Ð¾Ðµ Ð¿Ð¾Ð»Ðµ:**
   ```sql
   -- 000023_change_task_status_type.up.sql
   -- Ð¨Ð°Ð³ 1: Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð½Ð¾Ð²Ñ‹Ð¹ Ñ‚Ð¸Ð¿
   CREATE TYPE task_status_enum AS ENUM ('todo', 'in_progress', 'done');
   
   -- Ð¨Ð°Ð³ 2: Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð½Ð¾Ð²Ð¾Ðµ Ð¿Ð¾Ð»Ðµ
   ALTER TABLE tasks 
   ADD COLUMN status_new task_status_enum;
   
   -- Ð¨Ð°Ð³ 3: Ð¡ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ
   UPDATE tasks 
   SET status_new = CASE 
       WHEN status = 'todo' THEN 'todo'::task_status_enum
       WHEN status = 'in_progress' THEN 'in_progress'::task_status_enum
       WHEN status = 'done' THEN 'done'::task_status_enum
   END;
   
   -- Ð¨Ð°Ð³ 4: Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÑ‚Ð°Ñ€Ð¾Ðµ Ð¿Ð¾Ð»Ðµ
   ALTER TABLE tasks DROP COLUMN status;
   
   -- Ð¨Ð°Ð³ 5: ÐŸÐµÑ€ÐµÐ¸Ð¼ÐµÐ½Ð¾Ð²Ð°Ñ‚ÑŒ Ð½Ð¾Ð²Ð¾Ðµ Ð¿Ð¾Ð»Ðµ
   ALTER TABLE tasks RENAME COLUMN status_new TO status;
   
   -- Ð¨Ð°Ð³ 6: Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ NOT NULL
   ALTER TABLE tasks ALTER COLUMN status SET NOT NULL;
   ```

2. **ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð¼Ð¾Ð´ÐµÐ»ÑŒ:**
   ```go
   type TaskStatus string // ÐžÑÑ‚Ð°ÐµÑ‚ÑÑ string, Ð½Ð¾ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÑŽÑ‚ÑÑ
   ```

---

### Ð¨Ð°Ð³ 3: Ð ÐµÑ„Ð°ÐºÑ‚Ð¾Ñ€Ð¸Ð½Ð³ Ð¼Ð¾Ð´ÐµÐ»Ð¸

#### 3.1. Ð Ð°Ð·Ð´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð±Ð¾Ð»ÑŒÑˆÐ¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸

**ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°:** ÐœÐ¾Ð´ÐµÐ»ÑŒ ÑÑ‚Ð°Ð»Ð° ÑÐ»Ð¸ÑˆÐºÐ¾Ð¼ Ð±Ð¾Ð»ÑŒÑˆÐ¾Ð¹

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ:** Ð Ð°Ð·Ð´ÐµÐ»Ð¸Ñ‚ÑŒ Ð½Ð° Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ñ‚Ð°Ð±Ð»Ð¸Ñ†

**ÐŸÑ€Ð¸Ð¼ÐµÑ€:**
```
Ð‘Ñ‹Ð»Ð¾: tasks (Ð²ÑÐµ Ð¿Ð¾Ð»Ñ Ð² Ð¾Ð´Ð½Ð¾Ð¹ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ðµ)
Ð¡Ñ‚Ð°Ð»Ð¾: 
  - tasks (Ð¾ÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ Ð¿Ð¾Ð»Ñ)
  - task_metadata (Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¿Ð¾Ð»Ñ)
  - task_attachments (Ñ„Ð°Ð¹Ð»Ñ‹)
```

**ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ñ:**
```sql
-- 000024_split_tasks_table.up.sql
-- Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð½Ð¾Ð²ÑƒÑŽ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ Ð´Ð»Ñ Ð¼ÐµÑ‚Ð°Ð´Ð°Ð½Ð½Ñ‹Ñ…
CREATE TABLE task_metadata (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    task_id UUID NOT NULL UNIQUE,
    tags TEXT[],
    custom_fields JSONB,
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP NOT NULL DEFAULT NOW()
);

-- ÐŸÐµÑ€ÐµÐ½ÐµÑÑ‚Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ðµ (ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ)
INSERT INTO task_metadata (task_id, tags, custom_fields)
SELECT id, ARRAY[]::TEXT[], '{}'::JSONB
FROM tasks;

-- Foreign Key
ALTER TABLE task_metadata 
ADD CONSTRAINT fk_task_metadata_task 
FOREIGN KEY (task_id) REFERENCES tasks(id) ON DELETE CASCADE;
```

---

## ðŸ”— Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÑÐ¼Ð¸

### Ð¢Ð¸Ð¿Ñ‹ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹

#### 1. Foreign Key Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸

**ÐŸÑ€Ð¸Ð¼ÐµÑ€:**
```
tasks.user_id â†’ users.id
tasks.workspace_id â†’ workspaces.id
```

**ÐŸÑ€Ð°Ð²Ð¸Ð»Ð°:**
- ÐÐµÐ»ÑŒÐ·Ñ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ `users` ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ `tasks` Ñ ÑÑ‚Ð¸Ð¼ `user_id`
- ÐœÐ¾Ð¶Ð½Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ `ON DELETE CASCADE` Ð´Ð»Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ
- ÐœÐ¾Ð¶Ð½Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ `ON DELETE SET NULL` Ð´Ð»Ñ Ð¾Ð±Ð½ÑƒÐ»ÐµÐ½Ð¸Ñ

**Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ:**
```sql
ALTER TABLE tasks 
ADD CONSTRAINT fk_tasks_user 
FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE;
```

**Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ:**
```sql
ALTER TABLE tasks DROP CONSTRAINT fk_tasks_user;
```

---

#### 2. Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð² ÐºÐ¾Ð´Ðµ (Go)

**ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°:** Repository Ð·Ð°Ð²Ð¸ÑÐ¸Ñ‚ Ð¾Ñ‚ Ð´Ñ€ÑƒÐ³Ð¸Ñ… Repository

**ÐŸÑ€Ð¸Ð¼ÐµÑ€:**
```go
// âŒ ÐŸÐ›ÐžÐ¥Ðž: ÐŸÑ€ÑÐ¼Ð°Ñ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÑŒ
type TaskRepository struct {
    db *sql.DB
    userRepo *user.Repository // ÐŸÑ€ÑÐ¼Ð°Ñ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÑŒ
}

// âœ… Ð¥ÐžÐ ÐžÐ¨Ðž: Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÑŒ Ñ‡ÐµÑ€ÐµÐ· Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ
type UserRepository interface {
    GetByID(ctx context.Context, id uuid.UUID) (*model.User, error)
}

type TaskRepository struct {
    db       *sql.DB
    userRepo UserRepository // Ð˜Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ
}
```

---

#### 3. Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¼Ð¾Ð´ÑƒÐ»ÐµÐ¹

**ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°:** ÐœÐ¾Ð´ÑƒÐ»ÑŒ A Ð·Ð°Ð²Ð¸ÑÐ¸Ñ‚ Ð¾Ñ‚ Ð¼Ð¾Ð´ÑƒÐ»Ñ B

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ:** Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ (Event-Driven)

**ÐŸÑ€Ð¸Ð¼ÐµÑ€:**
```go
// ÐœÐ¾Ð´ÑƒÐ»ÑŒ Tasks Ð½Ðµ Ð·Ð½Ð°ÐµÑ‚ Ð¾ Ð¼Ð¾Ð´ÑƒÐ»Ðµ Habits
// ÐÐ¾ ÐºÐ¾Ð³Ð´Ð° Ð·Ð°Ð´Ð°Ñ‡Ð° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð° - Ð½ÑƒÐ¶Ð½Ð¾ Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÑƒ

// Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ
type TaskCompletedEvent struct {
    TaskID    uuid.UUID
    UserID    uuid.UUID
    WorkspaceID uuid.UUID
    CompletedAt time.Time
}

// Ð’ Task Service
func (s *Service) Complete(ctx context.Context, taskID string) error {
    // ... Ð·Ð°Ð²ÐµÑ€ÑˆÐ¸Ñ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ñƒ
    
    // ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ
    s.eventBus.Publish("task.completed", TaskCompletedEvent{
        TaskID: taskID,
        // ...
    })
    
    return nil
}

// Ð’ Habits Service (Ð¿Ð¾Ð´Ð¿Ð¸ÑÑ‡Ð¸Ðº)
func (s *Service) OnTaskCompleted(event TaskCompletedEvent) {
    // ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÑƒ Ð¿Ñ€Ð¸Ð²Ñ‹Ñ‡ÐµÐº
}
```

---

### Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹

#### Ð¨Ð°Ð³ 1: ÐÐ°Ð¹Ñ‚Ð¸ Ð²ÑÐµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ

```bash
# ÐÐ°Ð¹Ñ‚Ð¸ Ð²ÑÐµ Ð¼ÐµÑÑ‚Ð°, Ð³Ð´Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð¼Ð¾Ð´ÐµÐ»ÑŒ
grep -r "model.Task" backend/internal/

# ÐÐ°Ð¹Ñ‚Ð¸ Ð²ÑÐµ Foreign Keys
grep -r "fk_tasks" backend/migrations/
```

#### Ð¨Ð°Ð³ 2: Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Foreign Keys

```sql
-- 000025_remove_task_dependencies.up.sql
ALTER TABLE tasks DROP CONSTRAINT IF EXISTS fk_tasks_user;
ALTER TABLE tasks DROP CONSTRAINT IF EXISTS fk_tasks_workspace;
```

#### Ð¨Ð°Ð³ 3: Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ ÐºÐ¾Ð´

```go
// Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð¸Ð· repository
// Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð¸Ð· service
// Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð¸Ð· handler
```

#### Ð¨Ð°Ð³ 4: Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ

```sql
-- 000026_drop_tasks_table.up.sql
DROP TABLE IF EXISTS tasks;
```

---

## ðŸ”€ Ð¢Ð°Ð±Ð»Ð¸Ñ†Ñ‹ ÑÐ²ÑÐ·ÐµÐ¹ (Junction Tables)

### ÐšÐ¾Ð³Ð´Ð° Ð½ÑƒÐ¶Ð½Ð° Junction Table?

**Junction Table** Ð½ÑƒÐ¶Ð½Ð° Ð´Ð»Ñ ÑÐ²ÑÐ·Ð¸ **Ð¼Ð½Ð¾Ð³Ð¸Ðµ-ÐºÐ¾-Ð¼Ð½Ð¾Ð³Ð¸Ð¼ (N:M)**

**ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹:**
- ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ð¸ â†” Workspaces (Ð¾Ð´Ð¸Ð½ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð² Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¸Ñ… workspace, Ð¾Ð´Ð¸Ð½ workspace ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¸Ñ… Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹)
- Ð—Ð°Ð´Ð°Ñ‡Ð¸ â†” Ð¢ÐµÐ³Ð¸ (Ð¾Ð´Ð½Ð° Ð·Ð°Ð´Ð°Ñ‡Ð° Ð¼Ð¾Ð¶ÐµÑ‚ Ð¸Ð¼ÐµÑ‚ÑŒ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ñ‚ÐµÐ³Ð¾Ð², Ð¾Ð´Ð¸Ð½ Ñ‚ÐµÐ³ Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ñƒ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¸Ñ… Ð·Ð°Ð´Ð°Ñ‡)
- ÐŸÑ€Ð¾Ð´ÑƒÐºÑ‚Ñ‹ â†” ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ (Ð¾Ð´Ð¸Ð½ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚ Ð² Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¸Ñ… ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑÑ…, Ð¾Ð´Ð½Ð° ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð¾Ð²)

---

### Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Junction Table

**Ð‘Ð°Ð·Ð¾Ð²Ñ‹Ð¹ ÑˆÐ°Ð±Ð»Ð¾Ð½:**
```sql
CREATE TABLE junction_table_name (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    entity1_id UUID NOT NULL,
    entity2_id UUID NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    
    -- ÐŸÑ€ÐµÐ´Ð¾Ñ‚Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ Ð´ÑƒÐ±Ð»Ð¸ÐºÐ°Ñ‚Ñ‹
    UNIQUE(entity1_id, entity2_id)
);

-- Foreign Keys
ALTER TABLE junction_table_name 
ADD CONSTRAINT fk_junction_entity1 
FOREIGN KEY (entity1_id) REFERENCES entity1_table(id) ON DELETE CASCADE;

ALTER TABLE junction_table_name 
ADD CONSTRAINT fk_junction_entity2 
FOREIGN KEY (entity2_id) REFERENCES entity2_table(id) ON DELETE CASCADE;

-- Ð˜Ð½Ð´ÐµÐºÑÑ‹ Ð´Ð»Ñ Ð±Ñ‹ÑÑ‚Ñ€Ð¾Ð³Ð¾ Ð¿Ð¾Ð¸ÑÐºÐ° Ð² Ð¾Ð±Ðµ ÑÑ‚Ð¾Ñ€Ð¾Ð½Ñ‹
CREATE INDEX idx_junction_entity1 ON junction_table_name(entity1_id);
CREATE INDEX idx_junction_entity2 ON junction_table_name(entity2_id);
```

---

### ÐŸÑ€Ð¸Ð¼ÐµÑ€: Tasks â†” Tags

#### 1. Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ Ñ‚ÐµÐ³Ð¾Ð²

```sql
-- 000030_create_tags.up.sql
CREATE TABLE tags (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(100) NOT NULL UNIQUE,
    color VARCHAR(50) DEFAULT '#3B82F6',
    workspace_id UUID NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT NOW()
);

CREATE INDEX idx_tags_workspace ON tags(workspace_id);
```

#### 2. Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Junction Table

```sql
-- 000031_create_task_tags.up.sql
CREATE TABLE task_tags (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    task_id UUID NOT NULL,
    tag_id UUID NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    
    UNIQUE(task_id, tag_id)
);

ALTER TABLE task_tags 
ADD CONSTRAINT fk_task_tags_task 
FOREIGN KEY (task_id) REFERENCES tasks(id) ON DELETE CASCADE;

ALTER TABLE task_tags 
ADD CONSTRAINT fk_task_tags_tag 
FOREIGN KEY (tag_id) REFERENCES tags(id) ON DELETE CASCADE;

CREATE INDEX idx_task_tags_task ON task_tags(task_id);
CREATE INDEX idx_task_tags_tag ON task_tags(tag_id);
```

#### 3. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð² ÐºÐ¾Ð´Ðµ

```go
// Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ñƒ Ñ Ñ‚ÐµÐ³Ð°Ð¼Ð¸
func (r *Repository) CreateWithTags(ctx context.Context, dto model.CreateTaskDto, userID, workspaceID uuid.UUID, tagIDs []uuid.UUID) (*model.Task, error) {
    tx, err := r.db.BeginTx(ctx, nil)
    if err != nil {
        return nil, err
    }
    defer tx.Rollback()
    
    // 1. Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ñƒ
    task, err := r.createTask(ctx, tx, dto, userID, workspaceID)
    if err != nil {
        return nil, err
    }
    
    // 2. Ð¡Ð²ÑÐ·Ð°Ñ‚ÑŒ Ñ‚ÐµÐ³Ð¸
    for _, tagID := range tagIDs {
        _, err = tx.ExecContext(ctx,
            "INSERT INTO task_tags (id, task_id, tag_id, created_at) VALUES ($1, $2, $3, $4)",
            uuid.New(), task.ID, tagID, time.Now(),
        )
        if err != nil {
            return nil, err
        }
    }
    
    if err := tx.Commit(); err != nil {
        return nil, err
    }
    
    return task, nil
}

// ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ñƒ Ñ Ñ‚ÐµÐ³Ð°Ð¼Ð¸
func (r *Repository) GetWithTags(ctx context.Context, taskID uuid.UUID) (*model.Task, error) {
    // 1. ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ñƒ
    task, err := r.Get(ctx, taskID)
    if err != nil {
        return nil, err
    }
    
    // 2. ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ñ‚ÐµÐ³Ð¸
    query := `
        SELECT t.id, t.name, t.color, t.created_at
        FROM tags t
        INNER JOIN task_tags tt ON t.id = tt.tag_id
        WHERE tt.task_id = $1
        ORDER BY t.name
    `
    
    rows, err := r.db.QueryContext(ctx, query, taskID)
    if err != nil {
        return nil, err
    }
    defer rows.Close()
    
    var tags []model.Tag
    for rows.Next() {
        var tag model.Tag
        var createdAt time.Time
        rows.Scan(&tag.ID, &tag.Name, &tag.Color, &createdAt)
        tag.CreatedAt = createdAt.Format(time.RFC3339)
        tags = append(tags, tag)
    }
    
    task.Tags = tags
    return task, nil
}
```

---

### Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¿Ð¾Ð»Ñ Ð² Junction Table

**Ð˜Ð½Ð¾Ð³Ð´Ð° Ð½ÑƒÐ¶Ð½Ñ‹ Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¾ ÑÐ²ÑÐ·Ð¸:**

```sql
CREATE TABLE task_assignments (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    task_id UUID NOT NULL,
    user_id UUID NOT NULL,
    role VARCHAR(50) NOT NULL DEFAULT 'assignee', -- 'assignee', 'reviewer', 'watcher'
    assigned_at TIMESTAMP NOT NULL DEFAULT NOW(),
    assigned_by UUID, -- ÐšÑ‚Ð¾ Ð½Ð°Ð·Ð½Ð°Ñ‡Ð¸Ð»
    
    UNIQUE(task_id, user_id)
);
```

---

## ðŸ”„ ÐžÐ±Ñ€Ð°Ñ‚Ð½Ð°Ñ ÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð¾ÑÑ‚ÑŒ

### Ð§Ñ‚Ð¾ ÑÑ‚Ð¾?

**ÐžÐ±Ñ€Ð°Ñ‚Ð½Ð°Ñ ÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð¾ÑÑ‚ÑŒ** - ÑÐ¿Ð¾ÑÐ¾Ð±Ð½Ð¾ÑÑ‚ÑŒ Ð½Ð¾Ð²Ð¾Ð¹ Ð²ÐµÑ€ÑÐ¸Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ ÑÐ¾ ÑÑ‚Ð°Ñ€Ñ‹Ð¼Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ð¼Ð¸ Ð¸ API.

---

### Ð¡Ñ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ð¸

#### 1. Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð½Ð¾Ð²Ð¾Ð³Ð¾ Ð¿Ð¾Ð»Ñ

**âœ… Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ (Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ð¾ ÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð¾):**
```sql
-- Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð¿Ð¾Ð»Ðµ
ALTER TABLE tasks 
ADD COLUMN new_field VARCHAR(100); -- NULL Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ
```

**Ð’ ÐºÐ¾Ð´Ðµ:**
```go
type Task struct {
    // ... ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ðµ Ð¿Ð¾Ð»Ñ
    NewField *string `json:"newField,omitempty" db:"new_field"` // ÐžÐ¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾Ðµ
}
```

**Ð¡Ñ‚Ð°Ñ€Ñ‹Ð¹ ÐºÐ¾Ð´ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ**, Ð¿Ð¾Ñ‚Ð¾Ð¼Ñƒ Ñ‡Ñ‚Ð¾:
- ÐŸÐ¾Ð»Ðµ Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾Ðµ (Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ NULL)
- JSON `omitempty` Ð½Ðµ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð¿Ð¾Ð»Ðµ, ÐµÑÐ»Ð¸ Ð¾Ð½Ð¾ Ð¿ÑƒÑÑ‚Ð¾Ðµ
- Ð¡Ñ‚Ð°Ñ€Ñ‹Ðµ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñ‹ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¸Ð³Ð½Ð¾Ñ€Ð¸Ñ€ÑƒÑŽÑ‚ Ð½Ð¾Ð²Ð¾Ðµ Ð¿Ð¾Ð»Ðµ

---

#### 2. Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»Ñ

**âŒ ÐÐ• Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ (breaking change):**

```sql
-- Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð»Ðµ
ALTER TABLE tasks DROP COLUMN old_field;
```

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ: Deprecation Ð¿Ñ€Ð¾Ñ†ÐµÑÑ**

**Ð¨Ð°Ð³ 1: ÐŸÐ¾Ð¼ÐµÑ‚Ð¸Ñ‚ÑŒ ÐºÐ°Ðº deprecated**
```go
type Task struct {
    // ... Ð´Ñ€ÑƒÐ³Ð¸Ðµ Ð¿Ð¾Ð»Ñ
    OldField string `json:"oldField,omitempty" db:"old_field"` // DEPRECATED: Ð±ÑƒÐ´ÐµÑ‚ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¾ Ð² v2.0
}
```

**Ð¨Ð°Ð³ 2: ÐŸÐ¾Ð´Ð¾Ð¶Ð´Ð°Ñ‚ÑŒ Ð²ÐµÑ€ÑÐ¸ÑŽ**
- Ð’Ñ‹Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ð²ÐµÑ€ÑÐ¸ÑŽ Ñ deprecated Ð¿Ð¾Ð»ÐµÐ¼
- Ð”Ð°Ñ‚ÑŒ Ð²Ñ€ÐµÐ¼Ñ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°Ð¼ Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒÑÑ

**Ð¨Ð°Ð³ 3: Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ**
```sql
-- Ð’ Ð½Ð¾Ð²Ð¾Ð¹ Ð²ÐµÑ€ÑÐ¸Ð¸
ALTER TABLE tasks DROP COLUMN old_field;
```

---

#### 3. Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ñ‚Ð¸Ð¿Ð° Ð¿Ð¾Ð»Ñ

**âŒ ÐÐ• Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ**

**âœ… Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ñ‹Ð¹ ÑÐ¿Ð¾ÑÐ¾Ð±:**

**Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ A: Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð½Ð¾Ð²Ð¾Ðµ Ð¿Ð¾Ð»Ðµ, ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÑ‚Ð°Ñ€Ð¾Ðµ Ð¿Ð¾Ð·Ð¶Ðµ**
```sql
-- Ð¨Ð°Ð³ 1: Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð½Ð¾Ð²Ð¾Ðµ Ð¿Ð¾Ð»Ðµ
ALTER TABLE tasks 
ADD COLUMN status_new VARCHAR(50);

-- Ð¨Ð°Ð³ 2: ÐšÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ
UPDATE tasks 
SET status_new = CAST(status AS VARCHAR(50));

-- Ð¨Ð°Ð³ 3: Ð’ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ¹ Ð²ÐµÑ€ÑÐ¸Ð¸ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÑ‚Ð°Ñ€Ð¾Ðµ
-- ALTER TABLE tasks DROP COLUMN status;
-- ALTER TABLE tasks RENAME COLUMN status_new TO status;
```

**Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ B: ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° Ð¾Ð±Ð¾Ð¸Ñ… Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¾Ð² Ð² ÐºÐ¾Ð´Ðµ**
```go
type Task struct {
    Status    string `json:"status" db:"status"`        // Ð¡Ñ‚Ð°Ñ€Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚
    StatusNew string `json:"statusNew" db:"status_new"` // ÐÐ¾Ð²Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚
}

func (t *Task) GetStatus() string {
    if t.StatusNew != "" {
        return t.StatusNew
    }
    return t.Status // Fallback Ð½Ð° ÑÑ‚Ð°Ñ€Ñ‹Ð¹
}
```

---

#### 4. Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ API

**âŒ Breaking change:**
```go
// Ð‘Ñ‹Ð»Ð¾
GET /api/tasks?user_id=123

// Ð¡Ñ‚Ð°Ð»Ð¾
GET /api/tasks?userId=123
```

**âœ… ÐžÐ±Ñ€Ð°Ñ‚Ð½Ð¾ ÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð¾:**
```go
// ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ Ð¾Ð±Ð° Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ð°
func (h *Handler) List(c *gin.Context) {
    userID := c.Query("user_id")
    if userID == "" {
        userID = c.Query("userId") // ÐÐ¾Ð²Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚
    }
    // ...
}
```

---

### Ð’ÐµÑ€ÑÐ¸Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ API

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ:** Ð’ÐµÑ€ÑÐ¸Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ API

```
/api/v1/tasks  - ÑÑ‚Ð°Ñ€Ð°Ñ Ð²ÐµÑ€ÑÐ¸Ñ (deprecated)
/api/v2/tasks  - Ð½Ð¾Ð²Ð°Ñ Ð²ÐµÑ€ÑÐ¸Ñ
```

**Ð’ ÐºÐ¾Ð´Ðµ:**
```go
v1 := router.Group("/api/v1")
{
    v1.GET("/tasks", v1Handler.List)
}

v2 := router.Group("/api/v2")
{
    v2.GET("/tasks", v2Handler.List)
}
```

---

## ðŸ’¾ Ð¢Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸

### Ð§Ñ‚Ð¾ Ñ‚Ð°ÐºÐ¾Ðµ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ?

**Ð¢Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ** - Ð°Ñ‚Ð¾Ð¼Ð°Ñ€Ð½Ð°Ñ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ñ: Ð»Ð¸Ð±Ð¾ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ Ð²ÑÐµ, Ð»Ð¸Ð±Ð¾ Ð½Ð¸Ñ‡ÐµÐ³Ð¾.

**ACID ÑÐ²Ð¾Ð¹ÑÑ‚Ð²Ð°:**
- **Atomicity** (ÐÑ‚Ð¾Ð¼Ð°Ñ€Ð½Ð¾ÑÑ‚ÑŒ) - Ð²ÑÐµ Ð¸Ð»Ð¸ Ð½Ð¸Ñ‡ÐµÐ³Ð¾
- **Consistency** (Ð¡Ð¾Ð³Ð»Ð°ÑÐ¾Ð²Ð°Ð½Ð½Ð¾ÑÑ‚ÑŒ) - Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð²ÑÐµÐ³Ð´Ð° Ð² Ð²Ð°Ð»Ð¸Ð´Ð½Ð¾Ð¼ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ð¸
- **Isolation** (Ð˜Ð·Ð¾Ð»ÑÑ†Ð¸Ñ) - Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ Ð½Ðµ Ð¼ÐµÑˆÐ°ÑŽÑ‚ Ð´Ñ€ÑƒÐ³ Ð´Ñ€ÑƒÐ³Ñƒ
- **Durability** (Ð”Ð¾Ð»Ð³Ð¾Ð²ÐµÑ‡Ð½Ð¾ÑÑ‚ÑŒ) - Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÑŽÑ‚ÑÑ

---

### ÐšÐ¾Ð³Ð´Ð° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸?

#### âœ… Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ ÐºÐ¾Ð³Ð´Ð°:

1. **ÐÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ ÑÐ²ÑÐ·Ð°Ð½Ð½Ñ‹Ñ… Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¹**
   ```go
   // Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ñƒ Ð¸ Ð½Ð°Ð·Ð½Ð°Ñ‡Ð¸Ñ‚ÑŒ Ñ‚ÐµÐ³Ð¸
   tx, _ := db.BeginTx(ctx, nil)
   defer tx.Rollback()
   
   // 1. Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ñƒ
   task, _ := createTask(tx, ...)
   
   // 2. ÐÐ°Ð·Ð½Ð°Ñ‡Ð¸Ñ‚ÑŒ Ñ‚ÐµÐ³Ð¸
   for _, tagID := range tagIDs {
       assignTag(tx, task.ID, tagID)
   }
   
   tx.Commit() // Ð’ÑÐµ Ð¸Ð»Ð¸ Ð½Ð¸Ñ‡ÐµÐ³Ð¾
   ```

2. **ÐŸÐµÑ€ÐµÐ¼ÐµÑ‰ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¼ÐµÐ¶Ð´Ñƒ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð°Ð¼Ð¸**
   ```go
   // ÐŸÐµÑ€ÐµÐ½ÐµÑÑ‚Ð¸ Ð·Ð°Ð´Ð°Ñ‡Ñƒ Ð¸Ð· Ð¾Ð´Ð½Ð¾Ð³Ð¾ workspace Ð² Ð´Ñ€ÑƒÐ³Ð¾Ð¹
   tx, _ := db.BeginTx(ctx, nil)
   defer tx.Rollback()
   
   // 1. ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ workspace_id
   UPDATE tasks SET workspace_id = $1 WHERE id = $2
   
   // 2. ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÑÐ²ÑÐ·Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ
   UPDATE task_tags SET ... WHERE task_id = $2
   
   tx.Commit()
   ```

3. **Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ Ñ ÐºÐ°ÑÐºÐ°Ð´Ð¾Ð¼ (ÐºÐ¾Ð³Ð´Ð° CASCADE Ð½ÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾)**
   ```go
   // Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ workspace Ð¸ Ð²ÑÐµ ÑÐ²ÑÐ·Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ
   tx, _ := db.BeginTx(ctx, nil)
   defer tx.Rollback()
   
   // 1. Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð²ÑÐµ Ð·Ð°Ð´Ð°Ñ‡Ð¸
   DELETE FROM tasks WHERE workspace_id = $1
   
   // 2. Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð²ÑÐµ Ð¿Ñ€Ð¸Ð²Ñ‹Ñ‡ÐºÐ¸
   DELETE FROM habits WHERE workspace_id = $1
   
   // 3. Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ workspace
   DELETE FROM workspaces WHERE id = $1
   
   tx.Commit()
   ```

4. **ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÑ‡ÐµÑ‚Ñ‡Ð¸ÐºÐ¾Ð²/ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ¸**
   ```go
   // ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÑÑ‡ÐµÑ‚Ñ‡Ð¸Ðº Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð½Ñ‹Ñ… Ð·Ð°Ð´Ð°Ñ‡
   tx, _ := db.BeginTx(ctx, nil)
   defer tx.Rollback()
   
   // 1. Ð—Ð°Ð²ÐµÑ€ÑˆÐ¸Ñ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ñƒ
   UPDATE tasks SET status = 'done' WHERE id = $1
   
   // 2. Ð£Ð²ÐµÐ»Ð¸Ñ‡Ð¸Ñ‚ÑŒ ÑÑ‡ÐµÑ‚Ñ‡Ð¸Ðº
   UPDATE user_stats SET completed_tasks = completed_tasks + 1 WHERE user_id = $2
   
   tx.Commit()
   ```

---

#### âŒ ÐÐ• Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ ÐºÐ¾Ð³Ð´Ð°:

1. **ÐžÐ´Ð½Ð° Ð¿Ñ€Ð¾ÑÑ‚Ð°Ñ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ñ**
   ```go
   // âŒ Ð˜Ð·Ð±Ñ‹Ñ‚Ð¾Ñ‡Ð½Ð¾
   tx, _ := db.BeginTx(ctx, nil)
   UPDATE tasks SET title = $1 WHERE id = $2
   tx.Commit()
   
   // âœ… Ð”Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾
   db.ExecContext(ctx, "UPDATE tasks SET title = $1 WHERE id = $2", title, id)
   ```

2. **Ð”Ð¾Ð»Ð³Ð¸Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸**
   ```go
   // âŒ Ð¢Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ Ð±Ð»Ð¾ÐºÐ¸Ñ€ÑƒÐµÑ‚ Ð´Ñ€ÑƒÐ³Ð¸Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸
   tx, _ := db.BeginTx(ctx, nil)
   // Ð”Ð¾Ð»Ð³Ð°Ñ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ñ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ° email)
   sendEmail(...)
   tx.Commit()
   
   // âœ… Ð Ð°Ð·Ð´ÐµÐ»Ð¸Ñ‚ÑŒ Ð½Ð° Ñ‡Ð°ÑÑ‚Ð¸
   // 1. ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð‘Ð” (Ð±Ñ‹ÑÑ‚Ñ€Ð¾)
   db.ExecContext(ctx, "UPDATE ...")
   // 2. ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ email (Ð°ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ð¾, Ð²Ð½Ðµ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸)
   go sendEmail(...)
   ```

---

### ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð¸Ð· Ð²Ð°ÑˆÐµÐ³Ð¾ ÐºÐ¾Ð´Ð°

#### ÐŸÑ€Ð¸Ð¼ÐµÑ€ 1: Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¸Ð²Ñ‹Ñ‡ÐºÐ¸ (habits/repository.go)

```go
func (r *Repository) Delete(ctx context.Context, id, userID uuid.UUID) error {
    tx, err := r.db.BeginTx(ctx, nil)
    if err != nil {
        return fmt.Errorf("failed to begin transaction: %w", err)
    }
    defer tx.Rollback() // ÐžÑ‚ÐºÐ°Ñ‚Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐµ
    
    // 1. Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÐ²ÑÐ·Ð°Ð½Ð½Ñ‹Ðµ completions
    _, err = tx.ExecContext(ctx,
        "DELETE FROM habit_completions WHERE habit_id = $1 AND user_id = $2",
        id, userID,
    )
    if err != nil {
        return fmt.Errorf("failed to delete habit completions: %w", err)
    }
    
    // 2. Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¸Ð²Ñ‹Ñ‡ÐºÑƒ
    result, err := tx.ExecContext(ctx,
        "DELETE FROM habits WHERE id = $1 AND user_id = $2",
        id, userID,
    )
    if err != nil {
        return fmt.Errorf("failed to delete habit: %w", err)
    }
    
    // ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ, Ñ‡Ñ‚Ð¾ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¾
    rowsAffected, _ := result.RowsAffected()
    if rowsAffected == 0 {
        return sql.ErrNoRows
    }
    
    // ÐšÐ¾Ð¼Ð¼Ð¸Ñ‚Ð¸Ñ‚ÑŒ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸ÑŽ
    return tx.Commit()
}
```

**ÐŸÐ¾Ñ‡ÐµÐ¼Ñƒ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ Ð·Ð´ÐµÑÑŒ:**
- Ð”Ð²Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒÑÑ Ð²Ð¼ÐµÑÑ‚Ðµ
- Ð•ÑÐ»Ð¸ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ðµ completions ÑƒÑÐ¿ÐµÑˆÐ½Ð¾, Ð° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ðµ habit - Ð½ÐµÑ‚, Ð½ÑƒÐ¶Ð½Ð¾ Ð¾Ñ‚ÐºÐ°Ñ‚Ð¸Ñ‚ÑŒ Ð²ÑÐµ

---

#### ÐŸÑ€Ð¸Ð¼ÐµÑ€ 2: Toggle Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ (habits/repository.go)

```go
func (r *Repository) Toggle(ctx context.Context, habitID, userID uuid.UUID, date time.Time) (bool, *model.HabitCompletion, error) {
    tx, err := r.db.BeginTx(ctx, nil)
    if err != nil {
        return false, nil, fmt.Errorf("failed to begin transaction: %w", err)
    }
    defer tx.Rollback()
    
    // ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰ÐµÐµ completion
    var existing model.HabitCompletion
    err = tx.QueryRowContext(ctx,
        "SELECT * FROM habit_completions WHERE habit_id = $1 AND user_id = $2 AND date = $3",
        habitID, userID, date,
    ).Scan(...)
    
    if err == nil {
        // Ð¡ÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚ - ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ
        _, err = tx.ExecContext(ctx,
            "DELETE FROM habit_completions WHERE id = $1",
            existing.ID,
        )
        if err != nil {
            return false, nil, err
        }
        
        if err := tx.Commit(); err != nil {
            return false, nil, err
        }
        return false, &existing, nil
    }
    
    // ÐÐµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚ - ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ
    completion, err := r.Complete(ctx, habitID, userID, date, "", 0, nil)
    if err != nil {
        return false, nil, err
    }
    
    if err := tx.Commit(); err != nil {
        return false, nil, err
    }
    return true, completion, nil
}
```

**ÐŸÐ¾Ñ‡ÐµÐ¼Ñƒ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ Ð·Ð´ÐµÑÑŒ:**
- ÐŸÑ€ÐµÐ´Ð¾Ñ‚Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ race condition (Ð´Ð²Ð° Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° Ð¾Ð´Ð½Ð¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÑŽÑ‚ Ð¸ ÑÐ¾Ð·Ð´Ð°ÑŽÑ‚)
- Ð“Ð°Ñ€Ð°Ð½Ñ‚Ð¸Ñ€ÑƒÐµÑ‚ Ð°Ñ‚Ð¾Ð¼Ð°Ñ€Ð½Ð¾ÑÑ‚ÑŒ: Ð»Ð¸Ð±Ð¾ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ðµ, Ð»Ð¸Ð±Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ

---

### Ð£Ñ€Ð¾Ð²Ð½Ð¸ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ð¸

**PostgreSQL Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ ÑƒÑ€Ð¾Ð²Ð½Ð¸ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ð¸:**

```go
// Read Uncommitted (Ð½Ðµ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ÑÑ Ð² PostgreSQL)
// Read Committed (Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ)
tx, _ := db.BeginTx(ctx, &sql.TxOptions{
    Isolation: sql.LevelDefault, // Read Committed
})

// Repeatable Read
tx, _ := db.BeginTx(ctx, &sql.TxOptions{
    Isolation: sql.LevelRepeatableRead,
})

// Serializable
tx, _ := db.BeginTx(ctx, &sql.TxOptions{
    Isolation: sql.LevelSerializable,
})
```

**Ð’ Ð±Ð¾Ð»ÑŒÑˆÐ¸Ð½ÑÑ‚Ð²Ðµ ÑÐ»ÑƒÑ‡Ð°ÐµÐ² Ð´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ ÑƒÑ€Ð¾Ð²Ð½Ñ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ (Read Committed).**

---

### ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ð² Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸ÑÑ…

**ÐŸÑ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½:**
```go
func (r *Repository) ComplexOperation(ctx context.Context, ...) error {
    tx, err := r.db.BeginTx(ctx, nil)
    if err != nil {
        return fmt.Errorf("failed to begin transaction: %w", err)
    }
    defer tx.Rollback() // Ð’ÑÐµÐ³Ð´Ð° Ð¾Ñ‚ÐºÐ°Ñ‚Ñ‹Ð²Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¸ Ð²Ñ‹Ñ…Ð¾Ð´Ðµ
    
    // ÐžÐ¿ÐµÑ€Ð°Ñ†Ð¸Ñ 1
    if err := operation1(tx, ...); err != nil {
        return fmt.Errorf("operation1 failed: %w", err)
    }
    
    // ÐžÐ¿ÐµÑ€Ð°Ñ†Ð¸Ñ 2
    if err := operation2(tx, ...); err != nil {
        return fmt.Errorf("operation2 failed: %w", err)
    }
    
    // Ð’ÑÐµ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ - ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ð¸Ñ‚ÑŒ
    if err := tx.Commit(); err != nil {
        return fmt.Errorf("failed to commit transaction: %w", err)
    }
    
    return nil
}
```

**Ð’Ð°Ð¶Ð½Ð¾:**
- `defer tx.Rollback()` Ð²Ñ‹Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ð´Ð°Ð¶Ðµ Ð¿Ñ€Ð¸ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾Ð¼ Commit (Ð½Ð¾ Commit ÑƒÐ¶Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½, Ñ‚Ð°Ðº Ñ‡Ñ‚Ð¾ Rollback Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð´ÐµÐ»Ð°ÐµÑ‚)
- Ð•ÑÐ»Ð¸ Ð¿Ñ€Ð¾Ð¸Ð·Ð¾ÑˆÐ»Ð° Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð´Ð¾ Commit, Rollback Ð¾Ñ‚ÐºÐ°Ñ‚Ð¸Ñ‚ Ð²ÑÐµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ

---

## ðŸ‘‘ Ð¡ÑƒÐ¿ÐµÑ€-Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð¸ Ð¼Ð¾Ð´ÑƒÐ»Ð¸

### ÐšÐ¾Ð½Ñ†ÐµÐ¿Ñ†Ð¸Ñ

**Ð¡ÑƒÐ¿ÐµÑ€-Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ (Super Admin)** - Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ñ Ð¿Ñ€Ð°Ð²Ð°Ð¼Ð¸ Ð½Ð°:
- Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð½Ð¾Ð²Ñ‹Ñ… Ð¼Ð¾Ð´ÑƒÐ»ÐµÐ¹
- Ð’ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ/Ð¾Ñ‚ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð¼Ð¾Ð´ÑƒÐ»ÐµÐ¹ Ð´Ð»Ñ workspace
- Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÐ¸ÑÑ‚ÐµÐ¼Ð¾Ð¹

---

### Ð ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ

#### Ð¨Ð°Ð³ 1: Ð Ð°ÑÑˆÐ¸Ñ€Ð¸Ñ‚ÑŒ Ð¼Ð¾Ð´ÐµÐ»ÑŒ User

```sql
-- 000040_add_super_admin_to_users.up.sql
ALTER TABLE users 
ADD COLUMN is_super_admin BOOLEAN DEFAULT FALSE;

CREATE INDEX idx_users_super_admin ON users(is_super_admin) WHERE is_super_admin = TRUE;

COMMENT ON COLUMN users.is_super_admin IS 'Ð¡ÑƒÐ¿ÐµÑ€-Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹';
```

```go
// internal/model/user.go
type User struct {
    // ... ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ðµ Ð¿Ð¾Ð»Ñ
    IsSuperAdmin bool `json:"isSuperAdmin,omitempty" db:"is_super_admin"`
}
```

---

#### Ð¨Ð°Ð³ 2: Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ Ð¼Ð¾Ð´ÑƒÐ»ÐµÐ¹

```sql
-- 000041_create_modules.up.sql
CREATE TABLE modules (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(100) NOT NULL UNIQUE, -- 'habits', 'journal', 'tasks'
    title VARCHAR(255) NOT NULL, -- 'ÐŸÑ€Ð¸Ð²Ñ‹Ñ‡ÐºÐ¸', 'Ð–ÑƒÑ€Ð½Ð°Ð»', 'Ð—Ð°Ð´Ð°Ñ‡Ð¸'
    description TEXT,
    version VARCHAR(50) NOT NULL DEFAULT '1.0.0',
    enabled BOOLEAN DEFAULT TRUE, -- Ð’ÐºÐ»ÑŽÑ‡ÐµÐ½ Ð»Ð¸ Ð¼Ð¾Ð´ÑƒÐ»ÑŒ Ð² ÑÐ¸ÑÑ‚ÐµÐ¼Ðµ
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP NOT NULL DEFAULT NOW()
);

CREATE INDEX idx_modules_name ON modules(name);
CREATE INDEX idx_modules_enabled ON modules(enabled);

COMMENT ON TABLE modules IS 'ÐœÐ¾Ð´ÑƒÐ»Ð¸ ERP ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹';
COMMENT ON COLUMN modules.name IS 'Ð£Ð½Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾Ðµ Ð¸Ð¼Ñ Ð¼Ð¾Ð´ÑƒÐ»Ñ (Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð² ÐºÐ¾Ð´Ðµ)';
COMMENT ON COLUMN modules.enabled IS 'Ð’ÐºÐ»ÑŽÑ‡ÐµÐ½ Ð»Ð¸ Ð¼Ð¾Ð´ÑƒÐ»ÑŒ Ð² ÑÐ¸ÑÑ‚ÐµÐ¼Ðµ (Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð¾Ñ‚ÐºÐ»ÑŽÑ‡ÐµÐ½ ÑÑƒÐ¿ÐµÑ€-Ð°Ð´Ð¼Ð¸Ð½Ð¾Ð¼)';
```

---

#### Ð¨Ð°Ð³ 3: Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ workspace_modules

```sql
-- 000042_create_workspace_modules.up.sql
CREATE TABLE workspace_modules (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    workspace_id UUID NOT NULL,
    module_id UUID NOT NULL,
    enabled BOOLEAN DEFAULT TRUE, -- Ð’ÐºÐ»ÑŽÑ‡ÐµÐ½ Ð»Ð¸ Ð¼Ð¾Ð´ÑƒÐ»ÑŒ Ð´Ð»Ñ ÑÑ‚Ð¾Ð³Ð¾ workspace
    config JSONB, -- ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ Ð¼Ð¾Ð´ÑƒÐ»Ñ Ð´Ð»Ñ workspace
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP NOT NULL DEFAULT NOW(),
    
    UNIQUE(workspace_id, module_id)
);

ALTER TABLE workspace_modules 
ADD CONSTRAINT fk_workspace_modules_workspace 
FOREIGN KEY (workspace_id) REFERENCES workspaces(id) ON DELETE CASCADE;

ALTER TABLE workspace_modules 
ADD CONSTRAINT fk_workspace_modules_module 
FOREIGN KEY (module_id) REFERENCES modules(id) ON DELETE CASCADE;

CREATE INDEX idx_workspace_modules_workspace ON workspace_modules(workspace_id);
CREATE INDEX idx_workspace_modules_module ON workspace_modules(module_id);
CREATE INDEX idx_workspace_modules_enabled ON workspace_modules(workspace_id, enabled) WHERE enabled = TRUE;

COMMENT ON TABLE workspace_modules IS 'Ð¡Ð²ÑÐ·ÑŒ workspace Ñ Ð¼Ð¾Ð´ÑƒÐ»ÑÐ¼Ð¸';
COMMENT ON COLUMN workspace_modules.config IS 'JSON ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ Ð¼Ð¾Ð´ÑƒÐ»Ñ Ð´Ð»Ñ workspace';
```

---

#### Ð¨Ð°Ð³ 4: Seed Ð´Ð°Ð½Ð½Ñ‹Ðµ (ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¼Ð¾Ð´ÑƒÐ»Ð¸)

```sql
-- 000043_seed_modules.up.sql
INSERT INTO modules (id, name, title, description, version, enabled) VALUES
    (gen_random_uuid(), 'habits', 'ÐŸÑ€Ð¸Ð²Ñ‹Ñ‡ÐºÐ¸', 'ÐœÐ¾Ð´ÑƒÐ»ÑŒ Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°Ð½Ð¸Ñ Ð¿Ñ€Ð¸Ð²Ñ‹Ñ‡ÐµÐº', '1.0.0', TRUE),
    (gen_random_uuid(), 'journal', 'Ð–ÑƒÑ€Ð½Ð°Ð»', 'ÐœÐ¾Ð´ÑƒÐ»ÑŒ Ð²ÐµÐ´ÐµÐ½Ð¸Ñ Ð´Ð½ÐµÐ²Ð½Ð¸ÐºÐ°', '1.0.0', TRUE),
    (gen_random_uuid(), 'tasks', 'Ð—Ð°Ð´Ð°Ñ‡Ð¸', 'ÐœÐ¾Ð´ÑƒÐ»ÑŒ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð·Ð°Ð´Ð°Ñ‡Ð°Ð¼Ð¸', '1.0.0', FALSE) -- Ð’Ñ‹ÐºÐ»ÑŽÑ‡ÐµÐ½ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ
ON CONFLICT (name) DO NOTHING;
```

---

#### Ð¨Ð°Ð³ 5: ÐœÐ¾Ð´ÐµÐ»Ð¸

```go
// internal/model/module.go
package model

type Module struct {
    ID          string `json:"id" db:"id"`
    Name        string `json:"name" db:"name"`
    Title       string `json:"title" db:"title"`
    Description string `json:"description,omitempty" db:"description"`
    Version     string `json:"version" db:"version"`
    Enabled     bool   `json:"enabled" db:"enabled"`
    CreatedAt   string `json:"createdAt" db:"created_at"`
    UpdatedAt   string `json:"updatedAt" db:"updated_at"`
}

type WorkspaceModule struct {
    ID          string                 `json:"id" db:"id"`
    WorkspaceID string                 `json:"workspaceId" db:"workspace_id"`
    ModuleID    string                 `json:"moduleId" db:"module_id"`
    Enabled     bool                   `json:"enabled" db:"enabled"`
    Config      map[string]interface{} `json:"config,omitempty" db:"config"`
    CreatedAt   string                 `json:"createdAt" db:"created_at"`
    UpdatedAt   string                 `json:"updatedAt" db:"updated_at"`
}
```

---

#### Ð¨Ð°Ð³ 6: Middleware Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð¼Ð¾Ð´ÑƒÐ»ÐµÐ¹

```go
// internal/middleware/module.go
package middleware

import (
    "backend/internal/model"
    "github.com/gin-gonic/gin"
)

func RequireModule(moduleName string) gin.HandlerFunc {
    return func(c *gin.Context) {
        workspaceID, _ := GetWorkspaceIDFromGin(c)
        if workspaceID == "" {
            c.JSON(400, gin.H{"error": "Workspace required"})
            c.Abort()
            return
        }
        
        // ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ, Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½ Ð»Ð¸ Ð¼Ð¾Ð´ÑƒÐ»ÑŒ Ð´Ð»Ñ workspace
        // Ð­Ñ‚Ð¾ Ð½ÑƒÐ¶Ð½Ð¾ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ñ‚ÑŒ Ð² service
        // moduleService := ...
        // enabled, err := moduleService.IsModuleEnabled(workspaceID, moduleName)
        
        c.Next()
    }
}
```

---

#### Ð¨Ð°Ð³ 7: Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð² Ñ€Ð¾ÑƒÑ‚Ð°Ñ…

```go
// internal/router/router.go
func (r *Router) RegisterRoutes(container *di.Container) {
    api := r.engine.Group("/api")
    api.Use(middleware.Auth())
    
    // Habits Ð¼Ð¾Ð´ÑƒÐ»ÑŒ
    habits := api.Group("/habits")
    habits.Use(middleware.RequireWorkspace())
    habits.Use(middleware.RequireModule("habits")) // ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¼Ð¾Ð´ÑƒÐ»Ñ
    {
        container.HabitsHandler.RegisterRoutes(habits)
    }
    
    // Journal Ð¼Ð¾Ð´ÑƒÐ»ÑŒ
    journal := api.Group("/journal")
    journal.Use(middleware.RequireWorkspace())
    journal.Use(middleware.RequireModule("journal"))
    {
        container.JournalHandler.RegisterRoutes(journal)
    }
}
```

---

### API Ð´Ð»Ñ ÑÑƒÐ¿ÐµÑ€-Ð°Ð´Ð¼Ð¸Ð½Ð°

```go
// internal/handler/admin/handler.go
package admin

type Handler struct {
    moduleService *module.Service
    responder     *response.Responder
}

func (h *Handler) RegisterRoutes(r *gin.RouterGroup) {
    admin := r.Group("/admin")
    admin.Use(middleware.RequireSuperAdmin()) // ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑƒÐ¿ÐµÑ€-Ð°Ð´Ð¼Ð¸Ð½Ð°
    {
        admin.GET("/modules", h.ListModules)
        admin.POST("/modules", h.CreateModule)
        admin.PUT("/modules/:id", h.UpdateModule)
        admin.DELETE("/modules/:id", h.DeleteModule)
        admin.POST("/modules/:id/enable", h.EnableModule)
        admin.POST("/modules/:id/disable", h.DisableModule)
    }
}

func (h *Handler) ListModules(c *gin.Context) {
    modules, err := h.moduleService.List(c.Request.Context())
    if err != nil {
        h.responder.InternalServerError(c, "Failed to list modules")
        return
    }
    h.responder.SuccessWithData(c, gin.H{"modules": modules})
}

func (h *Handler) CreateModule(c *gin.Context) {
    var req model.CreateModuleDto
    if err := c.ShouldBindJSON(&req); err != nil {
        h.responder.BadRequest(c, "Invalid request")
        return
    }
    
    module, err := h.moduleService.Create(c.Request.Context(), req)
    if err != nil {
        h.responder.InternalServerError(c, "Failed to create module")
        return
    }
    
    h.responder.Created(c, "Module created", module)
}
```

---

### Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð¼Ð¾Ð´ÑƒÐ»Ñ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ

**ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ð¼Ð¾Ð´ÑƒÐ»ÑŒ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¸Ð¼ÐµÑ‚ÑŒ:**

```
module_name/
â”œâ”€â”€ migrations/
â”‚   â”œâ”€â”€ 000XXX_create_module_table.up.sql
â”‚   â””â”€â”€ 000XXX_create_module_table.down.sql
â”œâ”€â”€ model/
â”‚   â””â”€â”€ module_name.go
â”œâ”€â”€ repository/
â”‚   â””â”€â”€ repository.go
â”œâ”€â”€ service/
â”‚   â””â”€â”€ service.go
â””â”€â”€ handler/
    â”œâ”€â”€ handler.go
    â””â”€â”€ routes.go
```

**ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð´Ð»Ñ Ð¼Ð¾Ð´ÑƒÐ»Ñ Tasks:**

```
tasks/
â”œâ”€â”€ migrations/
â”‚   â”œâ”€â”€ 000020_create_tasks.up.sql
â”‚   â”œâ”€â”€ 000020_create_tasks.down.sql
â”‚   â”œâ”€â”€ 000021_create_task_tags.up.sql
â”‚   â””â”€â”€ 000021_create_task_tags.down.sql
â”œâ”€â”€ model/
â”‚   â””â”€â”€ task.go
â”œâ”€â”€ repository/
â”‚   â””â”€â”€ repository.go
â”œâ”€â”€ service/
â”‚   â””â”€â”€ service.go
â””â”€â”€ handler/
    â”œâ”€â”€ handler.go
    â””â”€â”€ routes.go
```

---

## ðŸ“Š SQL ÐœÐ°ÑÑ‚ÐµÑ€-ÐºÐ»Ð°ÑÑ

### ÐžÑÐ½Ð¾Ð²Ñ‹ SQL Ð´Ð»Ñ ERP

#### 1. SELECT Ñ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ð¼Ð¸

**Ð‘Ð°Ð·Ð¾Ð²Ñ‹Ð¹ Ð·Ð°Ð¿Ñ€Ð¾Ñ:**
```sql
SELECT id, title, status
FROM tasks
WHERE workspace_id = $1
ORDER BY created_at DESC;
```

**Ð¡ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ð¼Ð¸:**
```sql
SELECT id, title, status, priority
FROM tasks
WHERE workspace_id = $1
  AND user_id = $2
  AND status = 'todo'
  AND priority >= 3
  AND due_date >= CURRENT_DATE
ORDER BY priority DESC, created_at DESC;
```

**Ð¡ Ð¿Ð¾Ð¸ÑÐºÐ¾Ð¼:**
```sql
SELECT id, title
FROM tasks
WHERE workspace_id = $1
  AND (title ILIKE '%' || $2 || '%' OR description ILIKE '%' || $2 || '%')
ORDER BY created_at DESC;
```

**Ð¡ Ð¿Ð°Ð³Ð¸Ð½Ð°Ñ†Ð¸ÐµÐ¹:**
```sql
SELECT id, title, status
FROM tasks
WHERE workspace_id = $1
ORDER BY created_at DESC
LIMIT $2 OFFSET $3;
-- LIMIT = ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ Ð½Ð° ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ðµ
-- OFFSET = Ð¿Ñ€Ð¾Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ N Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ (Ð´Ð»Ñ Ð¿Ð°Ð³Ð¸Ð½Ð°Ñ†Ð¸Ð¸)
```

---

#### 2. JOIN Ð´Ð»Ñ ÑÐ²ÑÐ·Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ…

**INNER JOIN (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÑÐ¾Ð²Ð¿Ð°Ð´Ð°ÑŽÑ‰Ð¸Ðµ):**
```sql
SELECT 
    t.id,
    t.title,
    u.name AS assignee_name
FROM tasks t
INNER JOIN users u ON t.assignee_id = u.id
WHERE t.workspace_id = $1;
```

**LEFT JOIN (Ð²ÑÐµ Ð·Ð°Ð´Ð°Ñ‡Ð¸, Ð´Ð°Ð¶Ðµ Ð±ÐµÐ· assignee):**
```sql
SELECT 
    t.id,
    t.title,
    u.name AS assignee_name
FROM tasks t
LEFT JOIN users u ON t.assignee_id = u.id
WHERE t.workspace_id = $1;
```

**ÐœÐ½Ð¾Ð¶ÐµÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ðµ JOIN:**
```sql
SELECT 
    t.id,
    t.title,
    u.name AS assignee_name,
    w.name AS workspace_name
FROM tasks t
LEFT JOIN users u ON t.assignee_id = u.id
INNER JOIN workspaces w ON t.workspace_id = w.id
WHERE t.workspace_id = $1;
```

**JOIN Ñ Junction Table:**
```sql
SELECT 
    t.id,
    t.title,
    tag.name AS tag_name,
    tag.color AS tag_color
FROM tasks t
INNER JOIN task_tags tt ON t.id = tt.task_id
INNER JOIN tags tag ON tt.tag_id = tag.id
WHERE t.workspace_id = $1
ORDER BY t.created_at DESC, tag.name;
```

---

#### 3. ÐÐ³Ñ€ÐµÐ³Ð°Ñ‚Ð½Ñ‹Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸

**COUNT:**
```sql
SELECT COUNT(*) AS total_tasks
FROM tasks
WHERE workspace_id = $1;
```

**COUNT Ñ GROUP BY:**
```sql
SELECT status, COUNT(*) AS count
FROM tasks
WHERE workspace_id = $1
GROUP BY status;
-- Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:
-- status      | count
-- ------------|------
-- todo        | 10
-- in_progress | 5
-- done        | 20
```

**SUM, AVG, MIN, MAX:**
```sql
SELECT 
    COUNT(*) AS total,
    AVG(priority) AS avg_priority,
    MIN(created_at) AS first_task,
    MAX(created_at) AS last_task
FROM tasks
WHERE workspace_id = $1;
```

---

#### 4. ÐŸÐ¾Ð´Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹ (Subqueries)

**ÐŸÐ¾Ð´Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð² WHERE:**
```sql
SELECT id, title
FROM tasks
WHERE workspace_id = $1
  AND assignee_id IN (
      SELECT id FROM users 
      WHERE workspace_id = $1 AND role = 'member'
  );
```

**ÐŸÐ¾Ð´Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð² SELECT:**
```sql
SELECT 
    t.id,
    t.title,
    (SELECT COUNT(*) FROM task_comments WHERE task_id = t.id) AS comments_count
FROM tasks t
WHERE t.workspace_id = $1;
```

**EXISTS:**
```sql
SELECT id, title
FROM tasks t
WHERE workspace_id = $1
  AND EXISTS (
      SELECT 1 FROM task_tags tt 
      WHERE tt.task_id = t.id AND tt.tag_id = $2
  );
```

---

#### 5. ÐžÐºÐ¾Ð½Ð½Ñ‹Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ (Window Functions)

**ROW_NUMBER:**
```sql
SELECT 
    id,
    title,
    ROW_NUMBER() OVER (PARTITION BY workspace_id ORDER BY created_at DESC) AS row_num
FROM tasks
WHERE workspace_id = $1;
```

**RANK:**
```sql
SELECT 
    id,
    title,
    priority,
    RANK() OVER (PARTITION BY workspace_id ORDER BY priority DESC) AS priority_rank
FROM tasks
WHERE workspace_id = $1;
```

**SUM OVER:**
```sql
SELECT 
    date,
    COUNT(*) AS tasks_count,
    SUM(COUNT(*)) OVER (ORDER BY date) AS cumulative_count
FROM tasks
WHERE workspace_id = $1
GROUP BY date
ORDER BY date;
```

---

#### 6. CTE (Common Table Expressions)

**ÐŸÑ€Ð¾ÑÑ‚Ð¾Ð¹ CTE:**
```sql
WITH active_tasks AS (
    SELECT id, title, status
    FROM tasks
    WHERE workspace_id = $1 AND status != 'done'
)
SELECT * FROM active_tasks
ORDER BY created_at DESC;
```

**Ð ÐµÐºÑƒÑ€ÑÐ¸Ð²Ð½Ñ‹Ð¹ CTE (Ð´Ð»Ñ Ð¸ÐµÑ€Ð°Ñ€Ñ…Ð¸Ð¹):**
```sql
WITH RECURSIVE task_tree AS (
    -- Ð‘Ð°Ð·Ð¾Ð²Ñ‹Ð¹ ÑÐ»ÑƒÑ‡Ð°Ð¹: ÐºÐ¾Ñ€Ð½ÐµÐ²Ñ‹Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸
    SELECT id, title, parent_id, 1 AS level
    FROM tasks
    WHERE workspace_id = $1 AND parent_id IS NULL
    
    UNION ALL
    
    -- Ð ÐµÐºÑƒÑ€ÑÐ¸Ð²Ð½Ñ‹Ð¹ ÑÐ»ÑƒÑ‡Ð°Ð¹: Ð´Ð¾Ñ‡ÐµÑ€Ð½Ð¸Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸
    SELECT t.id, t.title, t.parent_id, tt.level + 1
    FROM tasks t
    INNER JOIN task_tree tt ON t.parent_id = tt.id
    WHERE t.workspace_id = $1
)
SELECT * FROM task_tree
ORDER BY level, created_at;
```

---

#### 7. ÐžÐ¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²

**Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¸Ð½Ð´ÐµÐºÑÐ¾Ð²:**
```sql
-- Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¸Ð½Ð´ÐµÐºÑ Ð´Ð»Ñ Ñ‡Ð°ÑÑ‚Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼Ñ‹Ñ… Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð¾Ð²
CREATE INDEX idx_tasks_workspace_status ON tasks(workspace_id, status);

-- Ð¡Ð¾ÑÑ‚Ð°Ð²Ð½Ð¾Ð¹ Ð¸Ð½Ð´ÐµÐºÑ Ð´Ð»Ñ ÑÐ»Ð¾Ð¶Ð½Ñ‹Ñ… Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²
CREATE INDEX idx_tasks_workspace_user_status ON tasks(workspace_id, user_id, status);
```

**EXPLAIN Ð´Ð»Ñ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°:**
```sql
EXPLAIN ANALYZE
SELECT id, title
FROM tasks
WHERE workspace_id = $1 AND status = 'todo'
ORDER BY created_at DESC;
```

**ÐŸÐ¾ÐºÑ€Ñ‹Ð²Ð°ÑŽÑ‰Ð¸Ð¹ Ð¸Ð½Ð´ÐµÐºÑ (Covering Index):**
```sql
-- Ð˜Ð½Ð´ÐµÐºÑ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ð²ÑÐµ Ð½ÑƒÐ¶Ð½Ñ‹Ðµ Ð¿Ð¾Ð»Ñ - Ð½Ðµ Ð½ÑƒÐ¶Ð½Ð¾ Ð¾Ð±Ñ€Ð°Ñ‰Ð°Ñ‚ÑŒÑÑ Ðº Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ðµ
CREATE INDEX idx_tasks_covering ON tasks(workspace_id, status) 
INCLUDE (id, title, created_at);
```

---

## ðŸŽ¯ ÐŸÑ€Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ñ‹

### ÐŸÑ€Ð¸Ð¼ÐµÑ€ 1: ÐŸÐ¾Ð»Ð½Ñ‹Ð¹ Ñ†Ð¸ÐºÐ» ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð¼Ð¾Ð´ÑƒÐ»Ñ Tasks

#### Ð¨Ð°Ð³ 1: ÐŸÐ»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ

**ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÑÐµÐ¼:**
- Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° `tasks` Ñ Ð¿Ð¾Ð»ÑÐ¼Ð¸: id, title, description, status, priority, due_date, user_id, workspace_id
- Ð¡Ð²ÑÐ·ÑŒ Ñ Ñ‚ÐµÐ³Ð°Ð¼Ð¸ Ñ‡ÐµÑ€ÐµÐ· junction table `task_tags`
- Ð¡Ð²ÑÐ·ÑŒ Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑÐ¼Ð¸ Ñ‡ÐµÑ€ÐµÐ· `assignee_id`

#### Ð¨Ð°Ð³ 2: ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸

**000020_create_tasks.up.sql:**
```sql
CREATE TABLE tasks (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    title VARCHAR(255) NOT NULL,
    description TEXT,
    status VARCHAR(50) NOT NULL DEFAULT 'todo',
    priority INTEGER CHECK (priority >= 1 AND priority <= 5),
    due_date DATE,
    assignee_id UUID,
    user_id UUID NOT NULL,
    workspace_id UUID NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP NOT NULL DEFAULT NOW(),
    
    CHECK (status IN ('todo', 'in_progress', 'done'))
);

CREATE INDEX idx_tasks_workspace ON tasks(workspace_id);
CREATE INDEX idx_tasks_user ON tasks(user_id);
CREATE INDEX idx_tasks_status ON tasks(status);
CREATE INDEX idx_tasks_assignee ON tasks(assignee_id);
```

**000020_create_tasks.down.sql:**
```sql
DROP TABLE IF EXISTS tasks;
```

**000021_create_task_tags.up.sql:**
```sql
CREATE TABLE task_tags (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    task_id UUID NOT NULL,
    tag_id UUID NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    
    UNIQUE(task_id, tag_id)
);

ALTER TABLE task_tags 
ADD CONSTRAINT fk_task_tags_task 
FOREIGN KEY (task_id) REFERENCES tasks(id) ON DELETE CASCADE;

ALTER TABLE task_tags 
ADD CONSTRAINT fk_task_tags_tag 
FOREIGN KEY (tag_id) REFERENCES tags(id) ON DELETE CASCADE;

CREATE INDEX idx_task_tags_task ON task_tags(task_id);
CREATE INDEX idx_task_tags_tag ON task_tags(tag_id);
```

**constraints/03_tasks_foreign_keys.up.sql:**
```sql
ALTER TABLE tasks 
ADD CONSTRAINT fk_tasks_user 
FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE;

ALTER TABLE tasks 
ADD CONSTRAINT fk_tasks_workspace 
FOREIGN KEY (workspace_id) REFERENCES workspaces(id) ON DELETE CASCADE;

ALTER TABLE tasks 
ADD CONSTRAINT fk_tasks_assignee 
FOREIGN KEY (assignee_id) REFERENCES users(id) ON DELETE SET NULL;
```

#### Ð¨Ð°Ð³ 3: ÐœÐ¾Ð´ÐµÐ»ÑŒ

```go
// internal/model/task.go
package model

type TaskStatus string

const (
    TaskStatusTodo       TaskStatus = "todo"
    TaskStatusInProgress TaskStatus = "in_progress"
    TaskStatusDone      TaskStatus = "done"
)

type Task struct {
    ID          string     `json:"id" db:"id"`
    Title       string     `json:"title" db:"title"`
    Description string     `json:"description,omitempty" db:"description"`
    Status      TaskStatus `json:"status" db:"status"`
    Priority    *int       `json:"priority,omitempty" db:"priority"`
    DueDate     string     `json:"dueDate,omitempty" db:"due_date"`
    AssigneeID  *string    `json:"assigneeId,omitempty" db:"assignee_id"`
    UserID      string     `json:"userId" db:"user_id"`
    WorkspaceID string     `json:"workspaceId" db:"workspace_id"`
    Tags        []Tag      `json:"tags,omitempty"`
    CreatedAt   string     `json:"createdAt" db:"created_at"`
    UpdatedAt   string     `json:"updatedAt" db:"updated_at"`
}

type CreateTaskDto struct {
    Title       string   `json:"title" binding:"required"`
    Description string   `json:"description,omitempty"`
    Status      string   `json:"status,omitempty"`
    Priority    *int     `json:"priority,omitempty"`
    DueDate     string   `json:"dueDate,omitempty"`
    AssigneeID  *string  `json:"assigneeId,omitempty"`
    TagIDs      []string `json:"tagIds,omitempty"`
}

type UpdateTaskDto struct {
    Title       *string `json:"title,omitempty"`
    Description *string `json:"description,omitempty"`
    Status      *string `json:"status,omitempty"`
    Priority    *int    `json:"priority,omitempty"`
    DueDate     *string `json:"dueDate,omitempty"`
    AssigneeID  *string `json:"assigneeId,omitempty"`
}
```

#### Ð¨Ð°Ð³ 4: Repository

```go
// internal/repository/tasks/repository.go
package tasks

import (
    "context"
    "database/sql"
    "fmt"
    "time"
    "backend/internal/model"
    "github.com/google/uuid"
)

type Repository struct {
    db *sql.DB
}

func NewRepository(db *sql.DB) *Repository {
    return &Repository{db: db}
}

func (r *Repository) Create(ctx context.Context, dto model.CreateTaskDto, userID, workspaceID uuid.UUID) (*model.Task, error) {
    tx, err := r.db.BeginTx(ctx, nil)
    if err != nil {
        return nil, fmt.Errorf("failed to begin transaction: %w", err)
    }
    defer tx.Rollback()
    
    taskID := uuid.New()
    now := time.Now()
    
    // ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ ÑÑ‚Ð°Ñ‚ÑƒÑ
    status := dto.Status
    if status == "" {
        status = string(model.TaskStatusTodo)
    }
    
    // Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ñƒ
    query := `
        INSERT INTO tasks (
            id, title, description, status, priority, due_date, 
            assignee_id, user_id, workspace_id, created_at, updated_at
        ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11)
        RETURNING id, title, description, status, priority, due_date, 
                  assignee_id, user_id, workspace_id, created_at, updated_at
    `
    
    var task model.Task
    var createdAt, updatedAt time.Time
    var dueDatePtr sql.NullTime
    var priorityPtr sql.NullInt64
    var assigneeIDPtr sql.NullString
    
    var dueDateValue interface{}
    if dto.DueDate != "" {
        dueDate, err := time.Parse("2006-01-02", dto.DueDate)
        if err == nil {
            dueDateValue = dueDate
        }
    }
    
    err = tx.QueryRowContext(ctx, query,
        taskID, dto.Title, dto.Description, status, dto.Priority, dueDateValue,
        dto.AssigneeID, userID, workspaceID, now, now,
    ).Scan(
        &task.ID, &task.Title, &task.Description, &task.Status,
        &priorityPtr, &dueDatePtr, &assigneeIDPtr,
        &task.UserID, &task.WorkspaceID, &createdAt, &updatedAt,
    )
    if err != nil {
        return nil, fmt.Errorf("failed to create task: %w", err)
    }
    
    // ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ NULL Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ
    if priorityPtr.Valid {
        p := int(priorityPtr.Int64)
        task.Priority = &p
    }
    if dueDatePtr.Valid {
        task.DueDate = dueDatePtr.Time.Format("2006-01-02")
    }
    if assigneeIDPtr.Valid {
        task.AssigneeID = &assigneeIDPtr.String
    }
    
    // Ð¡Ð²ÑÐ·Ð°Ñ‚ÑŒ Ñ‚ÐµÐ³Ð¸
    if len(dto.TagIDs) > 0 {
        for _, tagIDStr := range dto.TagIDs {
            tagID, err := uuid.Parse(tagIDStr)
            if err != nil {
                continue
            }
            
            _, err = tx.ExecContext(ctx,
                "INSERT INTO task_tags (id, task_id, tag_id, created_at) VALUES ($1, $2, $3, $4)",
                uuid.New(), taskID, tagID, now,
            )
            if err != nil {
                return nil, fmt.Errorf("failed to link tag: %w", err)
            }
        }
    }
    
    if err := tx.Commit(); err != nil {
        return nil, fmt.Errorf("failed to commit transaction: %w", err)
    }
    
    task.CreatedAt = createdAt.Format(time.RFC3339)
    task.UpdatedAt = updatedAt.Format(time.RFC3339)
    
    return &task, nil
}

func (r *Repository) List(ctx context.Context, userID, workspaceID uuid.UUID, filters map[string]interface{}) ([]model.Task, error) {
    query := `
        SELECT id, title, description, status, priority, due_date, 
               assignee_id, user_id, workspace_id, created_at, updated_at
        FROM tasks
        WHERE user_id = $1 AND workspace_id = $2
    `
    
    args := []interface{}{userID, workspaceID}
    argIndex := 3
    
    // Ð”Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹
    if status, ok := filters["status"].(string); ok && status != "" {
        query += fmt.Sprintf(" AND status = $%d", argIndex)
        args = append(args, status)
        argIndex++
    }
    
    if assigneeID, ok := filters["assignee_id"].(string); ok && assigneeID != "" {
        query += fmt.Sprintf(" AND assignee_id = $%d", argIndex)
        args = append(args, assigneeID)
        argIndex++
    }
    
    query += " ORDER BY created_at DESC"
    
    rows, err := r.db.QueryContext(ctx, query, args...)
    if err != nil {
        return nil, fmt.Errorf("failed to query tasks: %w", err)
    }
    defer rows.Close()
    
    var tasks []model.Task
    for rows.Next() {
        var task model.Task
        var createdAt, updatedAt time.Time
        var dueDatePtr sql.NullTime
        var priorityPtr sql.NullInt64
        var assigneeIDPtr sql.NullString
        
        err := rows.Scan(
            &task.ID, &task.Title, &task.Description, &task.Status,
            &priorityPtr, &dueDatePtr, &assigneeIDPtr,
            &task.UserID, &task.WorkspaceID, &createdAt, &updatedAt,
        )
        if err != nil {
            continue
        }
        
        if priorityPtr.Valid {
            p := int(priorityPtr.Int64)
            task.Priority = &p
        }
        if dueDatePtr.Valid {
            task.DueDate = dueDatePtr.Time.Format("2006-01-02")
        }
        if assigneeIDPtr.Valid {
            task.AssigneeID = &assigneeIDPtr.String
        }
        
        task.CreatedAt = createdAt.Format(time.RFC3339)
        task.UpdatedAt = updatedAt.Format(time.RFC3339)
        
        tasks = append(tasks, task)
    }
    
    return tasks, nil
}
```

---

### ÐŸÑ€Ð¸Ð¼ÐµÑ€ 2: Ð ÐµÑ„Ð°ÐºÑ‚Ð¾Ñ€Ð¸Ð½Ð³ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰ÐµÐ³Ð¾ Ð¼Ð¾Ð´ÑƒÐ»Ñ

**Ð—Ð°Ð´Ð°Ñ‡Ð°:** Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð»Ðµ `category` Ð² Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ `habits` Ñ Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ð¾Ð¹ ÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð¾ÑÑ‚ÑŒÑŽ

#### Ð¨Ð°Ð³ 1: Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ

```sql
-- 000050_add_category_to_habits.up.sql
ALTER TABLE habits 
ADD COLUMN category VARCHAR(100);

CREATE INDEX idx_habits_category ON habits(category);

COMMENT ON COLUMN habits.category IS 'ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ Ð¿Ñ€Ð¸Ð²Ñ‹Ñ‡ÐºÐ¸';
```

#### Ð¨Ð°Ð³ 2: ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð¼Ð¾Ð´ÐµÐ»ÑŒ

```go
// internal/model/habits.go
type Habit struct {
    // ... ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ðµ Ð¿Ð¾Ð»Ñ
    Category string `json:"category,omitempty" db:"category"` // ÐÐ¾Ð²Ð¾Ðµ Ð¿Ð¾Ð»Ðµ
}
```

#### Ð¨Ð°Ð³ 3: ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Repository

```go
func (r *Repository) Create(ctx context.Context, dto model.CreateHabitDto, ...) {
    query := `
        INSERT INTO habits (..., category, ...)
        VALUES (..., $N, ...)
    `
    // Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ category Ð² Scan
}

func (r *Repository) List(ctx context.Context, ...) {
    query := `
        SELECT ..., category, ...
        FROM habits
    `
    // Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ category Ð² Scan
}
```

#### Ð¨Ð°Ð³ 4: ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ DTOs

```go
type CreateHabitDto struct {
    // ... ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ðµ Ð¿Ð¾Ð»Ñ
    Category string `json:"category,omitempty"` // ÐÐ¾Ð²Ð¾Ðµ Ð¿Ð¾Ð»Ðµ
}
```

**Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:** Ð¡Ñ‚Ð°Ñ€Ñ‹Ð¹ ÐºÐ¾Ð´ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ, Ð½Ð¾Ð²Ð¾Ðµ Ð¿Ð¾Ð»Ðµ Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾Ðµ.

---

### ÐŸÑ€Ð¸Ð¼ÐµÑ€ 3: Ð¡Ð»Ð¾Ð¶Ð½Ð°Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ

**Ð—Ð°Ð´Ð°Ñ‡Ð°:** ÐŸÐµÑ€ÐµÐ½ÐµÑÑ‚Ð¸ Ð·Ð°Ð´Ð°Ñ‡Ñƒ Ð¸Ð· Ð¾Ð´Ð½Ð¾Ð³Ð¾ workspace Ð² Ð´Ñ€ÑƒÐ³Ð¾Ð¹ ÑÐ¾ Ð²ÑÐµÐ¼Ð¸ ÑÐ²ÑÐ·ÑÐ¼Ð¸

```go
func (r *Repository) MoveToWorkspace(ctx context.Context, taskID uuid.UUID, newWorkspaceID uuid.UUID, userID uuid.UUID) error {
    tx, err := r.db.BeginTx(ctx, nil)
    if err != nil {
        return fmt.Errorf("failed to begin transaction: %w", err)
    }
    defer tx.Rollback()
    
    // 1. ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ, Ñ‡Ñ‚Ð¾ Ð·Ð°Ð´Ð°Ñ‡Ð° ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚ Ð¸ Ð¿Ñ€Ð¸Ð½Ð°Ð´Ð»ÐµÐ¶Ð¸Ñ‚ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŽ
    var currentWorkspaceID uuid.UUID
    err = tx.QueryRowContext(ctx,
        "SELECT workspace_id FROM tasks WHERE id = $1 AND user_id = $2",
        taskID, userID,
    ).Scan(&currentWorkspaceID)
    if err != nil {
        return fmt.Errorf("task not found: %w", err)
    }
    
    if currentWorkspaceID == newWorkspaceID {
        return nil // Ð£Ð¶Ðµ Ð² Ð½ÑƒÐ¶Ð½Ð¾Ð¼ workspace
    }
    
    // 2. ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ workspace_id Ð·Ð°Ð´Ð°Ñ‡Ð¸
    _, err = tx.ExecContext(ctx,
        "UPDATE tasks SET workspace_id = $1, updated_at = NOW() WHERE id = $2",
        newWorkspaceID, taskID,
    )
    if err != nil {
        return fmt.Errorf("failed to update task: %w", err)
    }
    
    // 3. ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ñ‚ÐµÐ³Ð¸ (ÐµÑÐ»Ð¸ Ñ‚ÐµÐ³Ð¸ Ð¿Ñ€Ð¸Ð²ÑÐ·Ð°Ð½Ñ‹ Ðº workspace)
    // Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ñ‚ÐµÐ³Ð¸, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð½Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‚ Ð² Ð½Ð¾Ð²Ð¾Ð¼ workspace
    _, err = tx.ExecContext(ctx, `
        DELETE FROM task_tags tt
        USING tags t
        WHERE tt.tag_id = t.id 
          AND tt.task_id = $1
          AND t.workspace_id != $2
    `, taskID, newWorkspaceID)
    if err != nil {
        return fmt.Errorf("failed to update tags: %w", err)
    }
    
    // 4. Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð·Ð°Ð¿Ð¸ÑÑŒ Ð² Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ð¸ (ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð° task_history)
    _, err = tx.ExecContext(ctx, `
        INSERT INTO task_history (id, task_id, user_id, action, changes, created_at)
        VALUES ($1, $2, $3, 'MOVED', $4, NOW())
    `, uuid.New(), taskID, userID, fmt.Sprintf(`{"old_workspace_id": "%s", "new_workspace_id": "%s"}`, currentWorkspaceID, newWorkspaceID))
    if err != nil {
        // Ð›Ð¾Ð³Ð¸Ñ€ÑƒÐµÐ¼, Ð½Ð¾ Ð½Ðµ Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð°ÐµÐ¼ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸ÑŽ
        log.Printf("Failed to log history: %v", err)
    }
    
    // 5. ÐšÐ¾Ð¼Ð¼Ð¸Ñ‚Ð¸Ñ‚ÑŒ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸ÑŽ
    if err := tx.Commit(); err != nil {
        return fmt.Errorf("failed to commit transaction: %w", err)
    }
    
    return nil
}
```

---

## ðŸ“š Ð§ÐµÐº-Ð»Ð¸ÑÑ‚ Ð´Ð»Ñ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¼Ð¾Ð´ÑƒÐ»Ñ

### ÐŸÐµÑ€ÐµÐ´ Ð½Ð°Ñ‡Ð°Ð»Ð¾Ð¼

- [ ] ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ ÑÑƒÑ‰Ð½Ð¾ÑÑ‚Ð¸ Ð¸ Ð¸Ñ… Ð¿Ð¾Ð»Ñ
- [ ] ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ ÑÐ²ÑÐ·Ð¸ Ñ Ð´Ñ€ÑƒÐ³Ð¸Ð¼Ð¸ ÑÑƒÑ‰Ð½Ð¾ÑÑ‚ÑÐ¼Ð¸
- [ ] ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸ (CRUD)
- [ ] ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ Ð¸Ð½Ð´ÐµÐºÑÑ‹ Ð´Ð»Ñ Ð¾Ð¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð°Ñ†Ð¸Ð¸

### ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸

- [ ] Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ `.up.sql` Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ
- [ ] Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ `.down.sql` Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ
- [ ] Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Foreign Keys Ð² `constraints/`
- [ ] Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¸Ð½Ð´ÐµÐºÑÑ‹
- [ ] Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸ (COMMENT)
- [ ] ÐŸÑ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾

### ÐœÐ¾Ð´ÐµÐ»Ð¸

- [ ] Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¾ÑÐ½Ð¾Ð²Ð½ÑƒÑŽ Ð¼Ð¾Ð´ÐµÐ»ÑŒ
- [ ] Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ DTOs (Create, Update)
- [ ] Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸ÑŽ (binding tags)
- [ ] ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ NULL Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ (ÑƒÐºÐ°Ð·Ð°Ñ‚ÐµÐ»Ð¸)

### Repository

- [ ] Ð ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ñ‚ÑŒ Create
- [ ] Ð ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ñ‚ÑŒ Get/List
- [ ] Ð ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ñ‚ÑŒ Update
- [ ] Ð ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ñ‚ÑŒ Delete
- [ ] Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ Ð³Ð´Ðµ Ð½ÑƒÐ¶Ð½Ð¾
- [ ] ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ð¾ÑˆÐ¸Ð±ÐºÐ¸

### Service

- [ ] Ð ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ñ‚ÑŒ Ð±Ð¸Ð·Ð½ÐµÑ-Ð»Ð¾Ð³Ð¸ÐºÑƒ
- [ ] Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸ÑŽ
- [ ] ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ð¾ÑˆÐ¸Ð±ÐºÐ¸
- [ ] ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð°Ð²Ð° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°

### Handler

- [ ] Ð ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ñ‚ÑŒ HTTP endpoints
- [ ] Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸ÑŽ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²
- [ ] ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ð¾Ñ‚Ð²ÐµÑ‚Ñ‹
- [ ] Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ middleware (auth, workspace)

### Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ

- [ ] ÐŸÑ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ
- [ ] ÐŸÑ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ
- [ ] ÐŸÑ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ
- [ ] ÐŸÑ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ðµ
- [ ] ÐŸÑ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑÐ²ÑÐ·Ð¸
- [ ] ÐŸÑ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸

---

## ðŸŽ“ Ð˜Ñ‚Ð¾Ð³Ð¾Ð²Ñ‹Ðµ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸

### Ð”Ð»Ñ Ð¸Ð·ÑƒÑ‡ÐµÐ½Ð¸Ñ

1. **ÐÐ°Ñ‡Ð½Ð¸Ñ‚Ðµ Ñ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ð³Ð¾:** Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ð¹ Ð¼Ð¾Ð´ÑƒÐ»ÑŒ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Notes) Ð´Ð»Ñ Ð¿Ñ€Ð°ÐºÑ‚Ð¸ÐºÐ¸
2. **Ð˜Ð·ÑƒÑ‡Ð°Ð¹Ñ‚Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ð¹ ÐºÐ¾Ð´:** Ð¡Ð¼Ð¾Ñ‚Ñ€Ð¸Ñ‚Ðµ Ð½Ð° Habits Ð¼Ð¾Ð´ÑƒÐ»ÑŒ ÐºÐ°Ðº Ð½Ð° Ð¿Ñ€Ð¸Ð¼ÐµÑ€
3. **ÐŸÑ€Ð°ÐºÑ‚Ð¸ÐºÑƒÐ¹Ñ‚ÐµÑÑŒ:** Ð¡Ð¾Ð·Ð´Ð°Ð²Ð°Ð¹Ñ‚Ðµ Ð¼Ð¾Ð´ÑƒÐ»Ð¸ Ð¿Ð¾ ÑˆÐ°Ð±Ð»Ð¾Ð½Ñƒ
4. **Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸:** Ð’ÑÐµÐ³Ð´Ð° Ñ‚ÐµÑÑ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ up Ð¸ down Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸

### Ð”Ð»Ñ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸

1. **Ð¡Ð»ÐµÐ´ÑƒÐ¹Ñ‚Ðµ ÑˆÐ°Ð±Ð»Ð¾Ð½Ñƒ:** Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ Habits ÐºÐ°Ðº ÑˆÐ°Ð±Ð»Ð¾Ð½
2. **Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ:** ÐšÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ ÑÐ»Ð¾Ð¶Ð½Ñ‹Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð¸ Ð»Ð¾Ð³Ð¸ÐºÑƒ
3. **ÐžÐ±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°Ð¹Ñ‚Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:** Ð’ÑÐµÐ³Ð´Ð° Ð¾Ð±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°Ð¹Ñ‚Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾
4. **Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸:** Ð”Ð»Ñ ÑÐ²ÑÐ·Ð°Ð½Ð½Ñ‹Ñ… Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¹

### Ð”Ð»Ñ Ð¼Ð°ÑÑˆÑ‚Ð°Ð±Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ

1. **ÐŸÐ»Ð°Ð½Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð·Ð°Ñ€Ð°Ð½ÐµÐµ:** ÐŸÑ€Ð¾Ð´ÑƒÐ¼Ñ‹Ð²Ð°Ð¹Ñ‚Ðµ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ Ð¿ÐµÑ€ÐµÐ´ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸ÐµÐ¼
2. **Ð˜Ð·Ð±ÐµÐ³Ð°Ð¹Ñ‚Ðµ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹:** ÐœÐ¾Ð´ÑƒÐ»Ð¸ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð±Ñ‹Ñ‚ÑŒ Ð½ÐµÐ·Ð°Ð²Ð¸ÑÐ¸Ð¼Ñ‹
3. **Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ:** Ð”Ð»Ñ ÑÐ²ÑÐ·Ð¸ Ð¼ÐµÐ¶Ð´Ñƒ Ð¼Ð¾Ð´ÑƒÐ»ÑÐ¼Ð¸
4. **ÐžÐ¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹:** Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð¸Ð½Ð´ÐµÐºÑÑ‹ Ð¸ EXPLAIN

---

## ðŸ“– Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ñ€ÐµÑÑƒÑ€ÑÑ‹

### Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ

- [PostgreSQL Documentation](https://www.postgresql.org/docs/)
- [Go database/sql](https://pkg.go.dev/database/sql)
- [Gin Framework](https://gin-gonic.com/docs/)

### ÐŸÐ¾Ð»ÐµÐ·Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹

```bash
# ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸
migrate -path ./migrations -database "postgres://user:pass@localhost/dbname?sslmode=disable" up

# ÐžÑ‚ÐºÐ°Ñ‚Ð¸Ñ‚ÑŒ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸
migrate -path ./migrations -database "postgres://..." down 1

# ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ ÑÑ‚Ð°Ñ‚ÑƒÑ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹
migrate -path ./migrations -database "postgres://..." version

# Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð½Ð¾Ð²ÑƒÑŽ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ
migrate create -ext sql -dir ./migrations -seq create_new_table
```

---

**Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚ ÑÐ¾Ð·Ð´Ð°Ð½:** 2026-01-23  
**Ð’ÐµÑ€ÑÐ¸Ñ:** 1.0  
**ÐÐ²Ñ‚Ð¾Ñ€:** AI Assistant

**Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ ÑˆÐ°Ð³Ð¸:**
1. Ð˜Ð·ÑƒÑ‡Ð¸Ñ‚Ðµ ÑÑ‚Ð¾Ñ‚ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚ Ð¿Ð¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ
2. ÐŸÑ€Ð°ÐºÑ‚Ð¸ÐºÑƒÐ¹Ñ‚ÐµÑÑŒ Ð½Ð° Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ð¼ Ð¼Ð¾Ð´ÑƒÐ»Ðµ (Notes)
3. Ð ÐµÑ„Ð°ÐºÑ‚Ð¾Ñ€ÑŒÑ‚Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ð¹ ÐºÐ¾Ð´ Ð¿Ð¾ ÑˆÐ°Ð±Ð»Ð¾Ð½Ñƒ
4. Ð¡Ð¾Ð·Ð´Ð°Ð²Ð°Ð¹Ñ‚Ðµ Ð½Ð¾Ð²Ñ‹Ðµ Ð¼Ð¾Ð´ÑƒÐ»Ð¸ ÑÐ°Ð¼Ð¾ÑÑ‚Ð¾ÑÑ‚ÐµÐ»ÑŒÐ½Ð¾

**Ð£Ð´Ð°Ñ‡Ð¸ Ð² Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ! ðŸš€**
