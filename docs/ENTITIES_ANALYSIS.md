# –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å—É—â–Ω–æ—Å—Ç–µ–π Backend

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã](#–æ–±–∑–æ—Ä-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)
2. [–°—É—â–Ω–æ—Å—Ç–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#—Å—É—â–Ω–æ—Å—Ç–∏-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
3. [–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä Habits](#–¥–µ—Ç–∞–ª—å–Ω—ã–π-—Ä–∞–∑–±–æ—Ä-habits)
4. [–°–≤—è–∑–∏ –º–µ–∂–¥—É —Å—É—â–Ω–æ—Å—Ç—è–º–∏](#—Å–≤—è–∑–∏-–º–µ–∂–¥—É-—Å—É—â–Ω–æ—Å—Ç—è–º–∏)
5. [–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–∏–≤—ã—á–µ–∫](#–∏—Å—Ç–æ—Ä–∏—è-–∏–∑–º–µ–Ω–µ–Ω–∏–π-–ø—Ä–∏–≤—ã—á–µ–∫)
6. [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é](#—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏-–ø–æ-–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é)

---

## üèóÔ∏è –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–ª–æ–µ–≤ (Clean Architecture)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         HTTP Layer (Handler)            ‚îÇ  ‚Üê –ü—Ä–∏–Ω–∏–º–∞–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å—ã
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ         Service Layer                   ‚îÇ  ‚Üê –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ         Repository Layer                ‚îÇ  ‚Üê –†–∞–±–æ—Ç–∞ —Å –ë–î
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ         Database (PostgreSQL)           ‚îÇ  ‚Üê –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. **Handler** –ø–æ–ª—É—á–∞–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞
2. **Service** –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞, –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ, –ø—Ä–∏–º–µ–Ω—è–µ—Ç –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞
3. **Repository** –≤—ã–ø–æ–ª–Ω—è–µ—Ç SQL –∑–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
4. **Database** —Ö—Ä–∞–Ω–∏—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ

---

## üìä –°—É—â–Ω–æ—Å—Ç–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### 1. Users (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)

**–¢–∞–±–ª–∏—Ü–∞:** `users`

**–ü–æ–ª—è:**
- `id` (UUID) - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `email` (VARCHAR) - email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
- `password` (VARCHAR) - —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å
- `name` (VARCHAR, nullable) - –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `role` (VARCHAR) - —Ä–æ–ª—å: "USER" –∏–ª–∏ "ADMIN"
- `avatar_url` (VARCHAR, nullable) - —Å—Å—ã–ª–∫–∞ –Ω–∞ –∞–≤–∞—Ç–∞—Ä
- `status` (VARCHAR, nullable) - —Å—Ç–∞—Ç—É—Å: "ACTIVE"
- `created_at` (TIMESTAMP) - –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
- `updated_at` (TIMESTAMP) - –¥–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –•—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö —Å–∏—Å—Ç–µ–º—ã.

**–ò–Ω–¥–µ–∫—Å—ã:**
- –ü–æ `email` (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)

---

### 2. Workspaces (–†–∞–±–æ—á–∏–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞)

**–¢–∞–±–ª–∏—Ü–∞:** `workspaces`

**–ü–æ–ª—è:**
- `id` (UUID) - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `name` (VARCHAR) - –Ω–∞–∑–≤–∞–Ω–∏–µ workspace
- `description` (TEXT, nullable) - –æ–ø–∏—Å–∞–Ω–∏–µ
- `color` (VARCHAR) - —Ü–≤–µ—Ç –¥–ª—è UI (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é #3B82F6)
- `owner_id` (UUID) - –≤–ª–∞–¥–µ–ª–µ—Ü workspace (FK ‚Üí users.id)
- `created_at` (TIMESTAMP) - –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
- `updated_at` (TIMESTAMP) - –¥–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç—Ä–∏–≥–≥–µ—Ä–æ–º)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –†–∞–±–æ—á–∏–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏–≤—ã—á–µ–∫. –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ workspace.

**–°–≤—è–∑–∏:**
- `owner_id` ‚Üí `users.id` (–æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–ª–∞–¥–µ–µ—Ç workspace)

**–ò–Ω–¥–µ–∫—Å—ã:**
- `idx_workspaces_owner_id` - –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ workspace –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `idx_workspaces_created_at` - –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –¥–∞—Ç–µ

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç workspace ‚Üí –≤—Å–µ –µ–≥–æ –ø—Ä–∏–≤—ã—á–∫–∏ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ workspace
–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–∑–¥–µ–ª—è—Ç—å –ø—Ä–∏–≤—ã—á–∫–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º/–ø—Ä–æ–µ–∫—Ç–∞–º
```

---

### 3. User_Workspaces (–°–≤—è–∑—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ workspace)

**–¢–∞–±–ª–∏—Ü–∞:** `user_workspaces`

**–ü–æ–ª—è:**
- `id` (UUID) - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `user_id` (UUID) - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (FK ‚Üí users.id)
- `workspace_id` (UUID) - workspace (FK ‚Üí workspaces.id)
- `role` (VARCHAR) - —Ä–æ–ª—å –≤ workspace: "MEMBER", "ADMIN" –∏ —Ç.–¥.
- `created_at` (TIMESTAMP) - –¥–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ú–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º —Å–≤—è–∑—å –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ workspace. –ü–æ–∑–≤–æ–ª—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –æ–¥–Ω–æ–º workspace.

**–°–≤—è–∑–∏:**
- `user_id` ‚Üí `users.id` (ON DELETE CASCADE - –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–¥–∞–ª—è—é—Ç—Å—è —Å–≤—è–∑–∏)
- `workspace_id` ‚Üí `workspaces.id` (ON DELETE CASCADE - –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ workspace —É–¥–∞–ª—è—é—Ç—Å—è —Å–≤—è–∑–∏)

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- `UNIQUE(user_id, workspace_id)` - –æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω –≤ workspace –¥–≤–∞–∂–¥—ã

**–ò–Ω–¥–µ–∫—Å—ã:**
- `idx_user_workspaces_user_id` - –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤—Å–µ—Ö workspace –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `idx_user_workspaces_workspace_id` - –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π workspace

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å A —Å–æ–∑–¥–∞–µ—Ç workspace "–†–∞–±–æ—Ç–∞"
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å A –¥–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è B –≤ workspace
–¢–µ–ø–µ—Ä—å –æ–±–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –º–æ–≥—É—Ç –≤–∏–¥–µ—Ç—å –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–≤—ã—á–∫–∏ –≤ —ç—Ç–æ–º workspace
```

---

### 4. Habits (–ü—Ä–∏–≤—ã—á–∫–∏) ‚≠ê

**–¢–∞–±–ª–∏—Ü–∞:** `habits`

**–ü–æ–ª—è:**
- `id` (UUID) - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `title` (VARCHAR) - –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ)
- `description` (TEXT, nullable) - –æ–ø–∏—Å–∞–Ω–∏–µ
- `color` (VARCHAR) - —Ü–≤–µ—Ç –¥–ª—è UI (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é #3B82F6)
- `icon` (VARCHAR, nullable) - –∏–∫–æ–Ω–∫–∞/—ç–º–æ–¥–∑–∏
- `target_days` (INTEGER) - —Ü–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 7)
- `daily_goal` (INTEGER) - –¥–Ω–µ–≤–Ω–∞—è —Ü–µ–ª—å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1)
- `preferred_time` (TIME, nullable) - –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- `category` (VARCHAR, nullable) - –∫–∞—Ç–µ–≥–æ—Ä–∏—è –ø—Ä–∏–≤—ã—á–∫–∏
- `user_id` (UUID) - –≤–ª–∞–¥–µ–ª–µ—Ü –ø—Ä–∏–≤—ã—á–∫–∏ (FK ‚Üí users.id)
- `workspace_id` (UUID) - workspace, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –ø—Ä–∏–≤—ã—á–∫–∞ (FK ‚Üí workspaces.id)
- `created_at` (TIMESTAMP) - –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
- `updated_at` (TIMESTAMP) - –¥–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ç—Ä–∏–≥–≥–µ—Ä–æ–º)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û—Å–Ω–æ–≤–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å - —Ö—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–∏–≤—ã—á–∫–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

**–°–≤—è–∑–∏:**
- `user_id` ‚Üí `users.id` (–æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –º–Ω–æ–≥–æ –ø—Ä–∏–≤—ã—á–µ–∫)
- `workspace_id` ‚Üí `workspaces.id` (–ø—Ä–∏–≤—ã—á–∫–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç workspace)

**–ò–Ω–¥–µ–∫—Å—ã:**
- `idx_habits_user_id` - –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø—Ä–∏–≤—ã—á–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `idx_habits_workspace_id` - –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ workspace
- `idx_habits_created_at` - –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è
- `idx_habits_category` - –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–∏–≤—ã—á–∫—É "–ß—Ç–µ–Ω–∏–µ 30 –º–∏–Ω—É—Ç"
2. –ü—Ä–∏–≤—ã—á–∫–∞ –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è –∫ user_id –∏ workspace_id
3. –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–∏–≤—ã—á–∫–∏ —Ç—Ä–∏–≥–≥–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç updated_at
4. –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ workspace, –ø—Ä–∏–≤—ã—á–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è –∫–∞—Å–∫–∞–¥–Ω–æ
```

---

### 5. Habit_Completions (–í—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–∏–≤—ã—á–µ–∫)

**–¢–∞–±–ª–∏—Ü–∞:** `habit_completions`

**–ü–æ–ª—è:**
- `id` (UUID) - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `habit_id` (UUID) - –ø—Ä–∏–≤—ã—á–∫–∞ (FK ‚Üí habits.id)
- `user_id` (UUID) - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (FK ‚Üí users.id)
- `date` (DATE) - –¥–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- `notes` (TEXT, nullable) - –∑–∞–º–µ—Ç–∫–∏ –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏
- `rating` (INTEGER, nullable) - –æ—Ü–µ–Ω–∫–∞ –æ—Ç 1 –¥–æ 5
- `time` (TIME, nullable) - –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- `created_at` (TIMESTAMP) - –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –•—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–∏–≤—ã—á–µ–∫. –ö–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å = –æ–¥–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –¥–µ–Ω—å.

**–°–≤—è–∑–∏:**
- `habit_id` ‚Üí `habits.id` (ON DELETE CASCADE - –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø—Ä–∏–≤—ã—á–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)
- `user_id` ‚Üí `users.id` (ON DELETE CASCADE - –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- `UNIQUE(habit_id, date, user_id)` - **–≤–∞–∂–Ω–æ!** –û–¥–Ω–∞ –∑–∞–ø–∏—Å—å –Ω–∞ –¥–µ–Ω—å –¥–ª—è –∫–∞–∂–¥–æ–π –ø—Ä–∏–≤—ã—á–∫–∏
- `CHECK (rating >= 1 AND rating <= 5)` - —Ä–µ–π—Ç–∏–Ω–≥ –æ—Ç 1 –¥–æ 5

**–ò–Ω–¥–µ–∫—Å—ã:**
- `idx_completions_habit_id` - –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤—Å–µ—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π –ø—Ä–∏–≤—ã—á–∫–∏
- `idx_completions_user_id` - –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤—Å–µ—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `idx_completions_date` - –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –¥–∞—Ç–µ
- `idx_completions_habit_user_date` - —Å–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ø—Ä–∏–≤—ã—á–∫–∏ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –¥–µ–Ω—å
- `idx_completions_time` - –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ—á–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏ "–ß—Ç–µ–Ω–∏–µ" –Ω–∞ 2026-01-23
2. –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ habit_completions —Å habit_id, user_id, date
3. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—ã—Ç–∞–µ—Ç—Å—è –æ—Ç–º–µ—Ç–∏—Ç—å –µ—â–µ —Ä–∞–∑ –≤ —Ç–æ—Ç –∂–µ –¥–µ–Ω—å - –±—É–¥–µ—Ç –æ—à–∏–±–∫–∞ (UNIQUE constraint)
4. –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø—Ä–∏–≤—ã—á–∫–∏ –≤—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (CASCADE)
```

---

## üîó –°–≤—è–∑–∏ –º–µ–∂–¥—É —Å—É—â–Ω–æ—Å—Ç—è–º–∏

### –î–∏–∞–≥—Ä–∞–º–º–∞ —Å–≤—è–∑–µ–π

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Users   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ
     ‚îÇ 1:N (–æ–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º)
     ‚îÇ
     ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
     ‚îÇ                 ‚îÇ
     ‚ñº                 ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇWorkspaces‚îÇ    ‚îÇ   Habits     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ                 ‚îÇ
     ‚îÇ                 ‚îÇ 1:N (–æ–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º)
     ‚îÇ                 ‚îÇ
     ‚îÇ                 ‚ñº
     ‚îÇ          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
     ‚îÇ          ‚îÇHabit_Completions ‚îÇ
     ‚îÇ          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ
     ‚îÇ N:M (–º–Ω–æ–≥–∏–µ –∫–æ –º–Ω–æ–≥–∏–º)
     ‚îÇ
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇUser_Workspaces  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–≤—è–∑–µ–π

#### 1. Users ‚Üí Workspaces (1:N)
- **–¢–∏–ø:** –û–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º
- **–°–≤—è–∑—å:** `workspaces.owner_id` ‚Üí `users.id`
- **–ü–æ–≤–µ–¥–µ–Ω–∏–µ:** –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º –º–Ω–æ–≥–∏—Ö workspace
- **–ü—Ä–∏–º–µ—Ä:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç workspace "–†–∞–±–æ—Ç–∞" –∏ "–õ–∏—á–Ω–æ–µ"

#### 2. Users ‚Üí Habits (1:N)
- **–¢–∏–ø:** –û–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º
- **–°–≤—è–∑—å:** `habits.user_id` ‚Üí `users.id`
- **–ü–æ–≤–µ–¥–µ–Ω–∏–µ:** –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –º–Ω–æ–≥–æ –ø—Ä–∏–≤—ã—á–µ–∫
- **–ü—Ä–∏–º–µ—Ä:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–∏–≤—ã—á–∫–∏ "–ß—Ç–µ–Ω–∏–µ", "–°–ø–æ—Ä—Ç", "–ú–µ–¥–∏—Ç–∞—Ü–∏—è"

#### 3. Workspaces ‚Üí Habits (1:N)
- **–¢–∏–ø:** –û–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º
- **–°–≤—è–∑—å:** `habits.workspace_id` ‚Üí `workspaces.id`
- **–ü–æ–≤–µ–¥–µ–Ω–∏–µ:** –û–¥–∏–Ω workspace –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–Ω–æ–≥–æ –ø—Ä–∏–≤—ã—á–µ–∫
- **–ü—Ä–∏–º–µ—Ä:** –í workspace "–†–∞–±–æ—Ç–∞" –µ—Å—Ç—å –ø—Ä–∏–≤—ã—á–∫–∏ "–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π standup", "Code review"

#### 4. Habits ‚Üí Habit_Completions (1:N)
- **–¢–∏–ø:** –û–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º
- **–°–≤—è–∑—å:** `habit_completions.habit_id` ‚Üí `habits.id` (ON DELETE CASCADE)
- **–ü–æ–≤–µ–¥–µ–Ω–∏–µ:** –û–¥–Ω–∞ –ø—Ä–∏–≤—ã—á–∫–∞ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –º–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ –¥–µ–Ω—å)
- **CASCADE:** –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø—Ä–∏–≤—ã—á–∫–∏ –≤—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- **–ü—Ä–∏–º–µ—Ä:** –ü—Ä–∏–≤—ã—á–∫–∞ "–ß—Ç–µ–Ω–∏–µ" –∏–º–µ–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞ 2026-01-20, 2026-01-21, 2026-01-22

#### 5. Users ‚Üí Habit_Completions (1:N)
- **–¢–∏–ø:** –û–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º
- **–°–≤—è–∑—å:** `habit_completions.user_id` ‚Üí `users.id` (ON DELETE CASCADE)
- **–ü–æ–≤–µ–¥–µ–Ω–∏–µ:** –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –º–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π
- **CASCADE:** –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

#### 6. Users ‚Üî Workspaces (N:M —á–µ—Ä–µ–∑ User_Workspaces)
- **–¢–∏–ø:** –ú–Ω–æ–≥–∏–µ –∫–æ –º–Ω–æ–≥–∏–º
- **–°–≤—è–∑—å:** `user_workspaces.user_id` ‚Üí `users.id`, `user_workspaces.workspace_id` ‚Üí `workspaces.id`
- **–ü–æ–≤–µ–¥–µ–Ω–∏–µ:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö workspace, workspace –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–ü—Ä–∏–º–µ—Ä:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å A –∏ B –æ–±–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ workspace "–ö–æ–º–∞–Ω–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏"

---

## üéØ –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä Habits

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–±–æ—Ç—ã —Å Habits

```
HTTP Request
    ‚îÇ
    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Handler Layer  ‚îÇ  ‚Üê /api/habits (routes.go)
‚îÇ  - –í–∞–ª–∏–¥–∞—Ü–∏—è    ‚îÇ
‚îÇ  - –ü–∞—Ä—Å–∏–Ω–≥      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Service Layer  ‚îÇ  ‚Üê –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ  - –ü—Ä–æ–≤–µ—Ä–∫–∞     ‚îÇ
‚îÇ    workspace    ‚îÇ
‚îÇ  - –í–∞–ª–∏–¥–∞—Ü–∏—è    ‚îÇ
‚îÇ    –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇRepository Layer ‚îÇ  ‚Üê SQL –∑–∞–ø—Ä–æ—Å—ã
‚îÇ  - List()       ‚îÇ
‚îÇ  - Create()     ‚îÇ
‚îÇ  - Update()     ‚îÇ
‚îÇ  - Delete()     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   PostgreSQL    ‚îÇ  ‚Üê –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   - habits      ‚îÇ
‚îÇ   - completions ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –û–ø–µ—Ä–∞—Ü–∏–∏ —Å Habits

#### 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏ (Create)

**–ü—É—Ç—å:** `POST /api/habits`

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. **Handler** (`handler.go:Create`):
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ workspace –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
   - –ü–∞—Ä—Å–∏—Ç JSON –∑–∞–ø—Ä–æ—Å –≤ `CreateHabitDto`
   - –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ

2. **Service** (`service.go:Create`):
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ workspace –Ω–µ –ø—É—Å—Ç–æ–π
   - –ü–∞—Ä—Å–∏—Ç UUID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ workspace
   - –í—ã–∑—ã–≤–∞–µ—Ç repository

3. **Repository** (`repository.go:Create`):
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–π UUID –¥–ª—è –ø—Ä–∏–≤—ã—á–∫–∏
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:
     - `target_days = 7` (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ)
     - `daily_goal = 1` (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ)
     - `color = "#3B82F6"` (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ)
   - –í—ã–ø–æ–ª–Ω—è–µ—Ç SQL INSERT:
     ```sql
     INSERT INTO habits (
         id, title, description, color, icon, 
         target_days, daily_goal, preferred_time, category,
         user_id, workspace_id, created_at, updated_at
     ) VALUES ($1, $2, $3, ...)
     RETURNING *;
     ```
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—É—é –ø—Ä–∏–≤—ã—á–∫—É

**–ö–∞–∫ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ –ë–î:**
```sql
-- –ü—Ä–∏–º–µ—Ä SQL –∑–∞–ø—Ä–æ—Å–∞, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è:
INSERT INTO habits (
    id,                    -- uuid.New() ‚Üí '550e8400-e29b-41d4-a716-446655440000'
    title,                 -- '–ß—Ç–µ–Ω–∏–µ 30 –º–∏–Ω—É—Ç'
    description,           -- '–ß–∏—Ç–∞—Ç—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –ø–æ 30 –º–∏–Ω—É—Ç'
    color,                 -- '#3B82F6' (–∏–ª–∏ –∏–∑ –∑–∞–ø—Ä–æ—Å–∞)
    icon,                  -- 'üìö' (–∏–ª–∏ NULL)
    target_days,           -- 7 (–∏–ª–∏ –∏–∑ –∑–∞–ø—Ä–æ—Å–∞)
    daily_goal,            -- 1 (–∏–ª–∏ –∏–∑ –∑–∞–ø—Ä–æ—Å–∞)
    preferred_time,        -- '20:00:00' (–∏–ª–∏ NULL)
    category,              -- '–†–∞–∑–≤–∏—Ç–∏–µ' (–∏–ª–∏ NULL)
    user_id,               -- UUID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    workspace_id,          -- UUID workspace –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    created_at,            -- NOW() ‚Üí '2026-01-23 10:30:00'
    updated_at             -- NOW() ‚Üí '2026-01-23 10:30:00'
) VALUES (...);
```

**–°–≤—è–∑–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î:**
- `user_id` ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü–µ `users` (foreign key)
- `workspace_id` ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü–µ `workspaces` (foreign key)
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–ª–∏ workspace –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Üí –æ—à–∏–±–∫–∞

---

#### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–∏–≤—ã—á–µ–∫ (List)

**–ü—É—Ç—å:** `GET /api/habits`

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. **Handler** –ø–æ–ª—É—á–∞–µ—Ç `user_id` –∏ `workspace_id` –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
2. **Service** –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç UUID
3. **Repository** –≤—ã–ø–æ–ª–Ω—è–µ—Ç SQL:
   ```sql
   SELECT 
       id, title, description, color, icon, 
       target_days, daily_goal, preferred_time, category,
       user_id, workspace_id, 
       created_at, updated_at
   FROM habits 
   WHERE user_id = $1 AND workspace_id = $2
   ORDER BY created_at DESC
   ```

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è:**
- `WHERE user_id = $1` - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏–≤—ã—á–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `AND workspace_id = $2` - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏–≤—ã—á–∫–∏ –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ workspace
- `ORDER BY created_at DESC` - –Ω–æ–≤—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏ –ø–µ—Ä–≤—ã–º–∏

**–ò–Ω–¥–µ–∫—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è:**
- `idx_habits_user_id` - –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ user_id
- `idx_habits_workspace_id` - –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ workspace_id

---

#### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏ (Update)

**–ü—É—Ç—å:** `PUT /api/habits/:id`

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. **Handler** –ø–æ–ª—É—á–∞–µ—Ç ID –∏–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
2. **Service** –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏ –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
3. **Repository** (`repository.go:Update`):
   - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç SQL –∑–∞–ø—Ä–æ—Å –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–µ–π
   - –û–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–µ –ø–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ–¥–∞–Ω—ã (—á–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
   - **–í–∞–∂–Ω–æ:** –í—Å–µ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç `updated_at = NOW()`

**–ü—Ä–∏–º–µ—Ä SQL –∑–∞–ø—Ä–æ—Å–∞:**
```sql
UPDATE habits 
SET 
    title = $1,
    color = $2,
    updated_at = $3  -- –≤—Å–µ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
WHERE id = $4 AND user_id = $5
RETURNING *;
```

**–¢—Ä–∏–≥–≥–µ—Ä –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î:**
```sql
-- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ UPDATE:
CREATE TRIGGER update_habits_updated_at 
    BEFORE UPDATE ON habits 
    FOR EACH ROW 
    EXECUTE FUNCTION update_updated_at_column();
```

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –ü—Ä–∏ –∫–∞–∂–¥–æ–º UPDATE —Ç—Ä–∏–≥–≥–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `updated_at = NOW()`
- –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **–¥–æ** —Ç–æ–≥–æ, –∫–∞–∫ –∑–∞–ø–∏—Å—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î
- –î–∞–∂–µ –µ—Å–ª–∏ –≤ –∑–∞–ø—Ä–æ—Å–µ –Ω–µ —É–∫–∞–∑–∞–Ω–æ `updated_at`, –æ–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

#### 4. –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏ (Delete)

**–ü—É—Ç—å:** `DELETE /api/habits/:id`

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. **Service** –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
2. **Repository** (`repository.go:Delete`):
   - –ù–∞—á–∏–Ω–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
   - **–°–Ω–∞—á–∞–ª–∞** —É–¥–∞–ª—è–µ—Ç –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ `habit_completions`:
     ```sql
     DELETE FROM habit_completions 
     WHERE habit_id = $1 AND user_id = $2
     ```
   - **–ó–∞—Ç–µ–º** —É–¥–∞–ª—è–µ—Ç —Å–∞–º—É –ø—Ä–∏–≤—ã—á–∫—É:
     ```sql
     DELETE FROM habits 
     WHERE id = $1 AND user_id = $2
     ```
   - –ö–æ–º–º–∏—Ç–∏—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é

**–ü–æ—á–µ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è:**
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å: –ª–∏–±–æ —É–¥–∞–ª—è–µ—Ç—Å—è –≤—Å–µ, –ª–∏–±–æ –Ω–∏—á–µ–≥–æ
- –ï—Å–ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ completions —É—Å–ø–µ—à–Ω–æ, –∞ —É–¥–∞–ª–µ–Ω–∏–µ habit - –Ω–µ—Ç, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è (ROLLBACK)
- –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç "–≤–∏—Å—è—â–∏–µ" –∑–∞–ø–∏—Å–∏ completions –±–µ–∑ –ø—Ä–∏–≤—ã—á–∫–∏

**CASCADE —É–¥–∞–ª–µ–Ω–∏–µ:**
- Foreign key `habit_completions.habit_id` –∏–º–µ–µ—Ç `ON DELETE CASCADE`
- –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ PostgreSQL –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–∏—Ç completions –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ habit
- –ù–æ –≤ –∫–æ–¥–µ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è —è–≤–Ω–æ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

---

#### 5. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏ (Complete)

**–ü—É—Ç—å:** `POST /api/habits/:id/complete`

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. **Handler** –ø–æ–ª—É—á–∞–µ—Ç –¥–∞—Ç—É, –∑–∞–º–µ—Ç–∫–∏, —Ä–µ–π—Ç–∏–Ω–≥, –≤—Ä–µ–º—è
2. **Service** –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏
3. **Repository** (`repository.go:Complete`):
   - –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å –≤ `habit_completions`:
     ```sql
     INSERT INTO habit_completions (
         id, habit_id, user_id, date, notes, rating, time, created_at
     ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8)
     RETURNING *;
     ```

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- `UNIQUE(habit_id, date, user_id)` - –Ω–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å –¥–≤–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ –æ–¥–∏–Ω –¥–µ–Ω—å
- –ï—Å–ª–∏ –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è —Å–æ–∑–¥–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç ‚Üí –æ—à–∏–±–∫–∞ –æ—Ç –ë–î

**–ö–∞–∫ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∑–∞–ø–∏—Å—å:**
```sql
INSERT INTO habit_completions (
    id,                    -- uuid.New()
    habit_id,              -- UUID –ø—Ä–∏–≤—ã—á–∫–∏
    user_id,               -- UUID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    date,                  -- '2026-01-23'
    notes,                 -- '–ü—Ä–æ—á–∏—Ç–∞–ª –≥–ª–∞–≤—É 5' (–∏–ª–∏ NULL)
    rating,                -- 4 (–∏–ª–∏ NULL, –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω)
    time,                  -- '20:30:00' (–∏–ª–∏ NULL)
    created_at             -- NOW()
) VALUES (...);
```

---

#### 6. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (Toggle)

**–ü—É—Ç—å:** `POST /api/habits/:id/toggle`

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. **Repository** (`repository.go:Toggle`):
   - –ù–∞—á–∏–Ω–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—É—é –¥–∞—Ç—É:
     ```sql
     SELECT * FROM habit_completions 
     WHERE habit_id = $1 AND user_id = $2 AND date = $3
     LIMIT 1
     ```
   - **–ï—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:**
     - –£–¥–∞–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
     - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `completed = false`
   - **–ï—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:**
     - –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `Complete()`
     - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `completed = true`
   - –ö–æ–º–º–∏—Ç–∏—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é

**–ó–∞—á–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è:**
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç race condition (–∫–æ–≥–¥–∞ –¥–≤–∞ –∑–∞–ø—Ä–æ—Å–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –∏ —Å–æ–∑–¥–∞—é—Ç)

---

#### 7. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–∏–≤—ã—á–∫–∏ (GetStats)

**–ü—É—Ç—å:** `GET /api/habits/:id/stats`

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. **Repository** (`repository.go:GetStats`):
   - –ü–æ–ª—É—á–∞–µ—Ç –¥–∞—Ç—É —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∏–≤—ã—á–∫–∏:
     ```sql
     SELECT created_at FROM habits 
     WHERE id = $1 AND user_id = $2
     ```
   - –í—ã—á–∏—Å–ª—è–µ—Ç –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π: `today - created_at + 1`
   - –°—á–∏—Ç–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–Ω–∏:
     ```sql
     SELECT COUNT(*) FROM habit_completions 
     WHERE habit_id = $1 AND user_id = $2
     ```
   - –í—ã—á–∏—Å–ª—è–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: `completed_days / total_days * 100`
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

**–ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á–µ—Ç–∞:**
```
–ü—Ä–∏–≤—ã—á–∫–∞ —Å–æ–∑–¥–∞–Ω–∞: 2026-01-01
–°–µ–≥–æ–¥–Ω—è: 2026-01-23
–í—Å–µ–≥–æ –¥–Ω–µ–π: 23
–í—ã–ø–æ–ª–Ω–µ–Ω–æ: 15 –¥–Ω–µ–π
–ü—Ä–æ—Ü–µ–Ω—Ç: 15/23 = 65.2%
```

---

#### 8. –ö–∞–ª–µ–Ω–¥–∞—Ä—å (GetCalendar)

**–ü—É—Ç—å:** `GET /api/habits/calendar?start=2026-01-01&end=2026-01-31`

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. **Repository** (`repository.go:GetCalendar`):
   - –ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ –ø—Ä–∏–≤—ã—á–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ workspace:
     ```sql
     SELECT id, title, color
     FROM habits 
     WHERE user_id = $1 AND workspace_id = $2
     ```
   - –ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞ –ø–µ—Ä–∏–æ–¥:
     ```sql
     SELECT habit_id, date
     FROM habit_completions 
     WHERE user_id = $1 AND habit_id = ANY($2::uuid[]) 
       AND date BETWEEN $3 AND $4
     ```
   - –°–æ–∑–¥–∞–µ—Ç –º–∞–ø—É: `date ‚Üí habit_id ‚Üí completed`
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –º–∞—Å—Å–∏–≤ –¥–Ω–µ–π —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–∞–∂–¥–æ–π –ø—Ä–∏–≤—ã—á–∫–∏

**–ö–∞–∫ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –æ—Ç–≤–µ—Ç:**
```json
{
  "days": [
    {
      "date": "2026-01-23",
      "habits": [
        {
          "id": "habit-1",
          "title": "–ß—Ç–µ–Ω–∏–µ",
          "completed": true,
          "color": "#3B82F6"
        },
        {
          "id": "habit-2",
          "title": "–°–ø–æ—Ä—Ç",
          "completed": false,
          "color": "#10B981"
        }
      ]
    }
  ]
}
```

---

## üìù –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–∏–≤—ã—á–µ–∫

### –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è

**‚ùå –ü—Ä–æ–±–ª–µ–º–∞:** –í —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ **–ù–ï–¢** —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–∏–≤—ã—á–µ–∫.

**–ß—Ç–æ –µ—Å—Ç—å:**
- `habits.updated_at` - —Ç–æ–ª—å–∫–æ –¥–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–æ–º, **—á—Ç–æ –∏–º–µ–Ω–Ω–æ** –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
- –ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–æ–º, **–∫—Ç–æ** –∏–∑–º–µ–Ω–∏–ª (–µ—Å–ª–∏ –±—É–¥–µ—Ç –º—É–ª—å—Ç–∏–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –¥–æ—Å—Ç—É–ø)
- –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ —É–¥–∞–ª–µ–Ω–∏–π

### –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –¢–∞–±–ª–∏—Ü–∞ –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É:** `habit_history`

```sql
CREATE TABLE habit_history (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    habit_id UUID NOT NULL REFERENCES habits(id) ON DELETE CASCADE,
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    
    -- –¢–∏–ø –∏–∑–º–µ–Ω–µ–Ω–∏—è
    action VARCHAR(50) NOT NULL,  -- 'CREATED', 'UPDATED', 'DELETED', 'COMPLETED'
    
    -- –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å (JSON –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏)
    changes JSONB,  -- {"title": {"old": "–°—Ç–∞—Ä–æ–µ", "new": "–ù–æ–≤–æ–µ"}}
    
    -- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    metadata JSONB,  -- {"ip": "...", "user_agent": "..."}
    
    created_at TIMESTAMP NOT NULL DEFAULT NOW()
);

CREATE INDEX idx_habit_history_habit_id ON habit_history(habit_id);
CREATE INDEX idx_habit_history_user_id ON habit_history(user_id);
CREATE INDEX idx_habit_history_action ON habit_history(action);
CREATE INDEX idx_habit_history_created_at ON habit_history(created_at);
CREATE INDEX idx_habit_history_habit_created ON habit_history(habit_id, created_at);
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON –≤ –ø–æ–ª–µ `changes`:**
```json
{
  "title": {
    "old": "–ß—Ç–µ–Ω–∏–µ",
    "new": "–ß—Ç–µ–Ω–∏–µ –∫–Ω–∏–≥"
  },
  "color": {
    "old": "#3B82F6",
    "new": "#10B981"
  }
}
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON –≤ –ø–æ–ª–µ `metadata`:**
```json
{
  "ip": "192.168.1.1",
  "user_agent": "Mozilla/5.0...",
  "workspace_id": "550e8400-..."
}
```

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ –∫–æ–¥–µ

**1. –î–æ–±–∞–≤–∏—Ç—å –º–æ–¥–µ–ª—å:**
```go
// internal/model/habits.go
type HabitHistory struct {
    ID        string                 `json:"id"`
    HabitID   string                 `json:"habitId"`
    UserID    string                 `json:"userId"`
    Action    string                 `json:"action"`  // CREATED, UPDATED, DELETED, COMPLETED
    Changes   map[string]interface{} `json:"changes,omitempty"`
    Metadata  map[string]interface{} `json:"metadata,omitempty"`
    CreatedAt string                 `json:"createdAt"`
}
```

**2. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –≤ Repository:**
```go
// internal/repository/habits/repository.go

// CreateHistory - —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏–∏
func (r *Repository) CreateHistory(ctx context.Context, habitID, userID uuid.UUID, action string, changes, metadata map[string]interface{}) error {
    query := `
        INSERT INTO habit_history (
            id, habit_id, user_id, action, changes, metadata, created_at
        ) VALUES ($1, $2, $3, $4, $5, $6, $7)
    `
    
    changesJSON, _ := json.Marshal(changes)
    metadataJSON, _ := json.Marshal(metadata)
    
    _, err := r.db.ExecContext(ctx, query,
        uuid.New(),
        habitID,
        userID,
        action,
        changesJSON,
        metadataJSON,
        time.Now(),
    )
    return err
}

// GetHistory - –ø–æ–ª—É—á–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–∏–≤—ã—á–∫–∏
func (r *Repository) GetHistory(ctx context.Context, habitID, userID uuid.UUID, limit int) ([]model.HabitHistory, error) {
    query := `
        SELECT id, habit_id, user_id, action, changes, metadata, created_at
        FROM habit_history
        WHERE habit_id = $1 AND user_id = $2
        ORDER BY created_at DESC
        LIMIT $3
    `
    // ... —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
}
```

**3. –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã Create, Update, Delete:**
```go
// –í –º–µ—Ç–æ–¥–µ Create –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∏–≤—ã—á–∫–∏:
func (r *Repository) Create(ctx context.Context, dto model.CreateHabitDto, userID, workspaceID uuid.UUID) (*model.Habit, error) {
    // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è
    
    // –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏—é
    changes := map[string]interface{}{
        "title": dto.Title,
        "color": dto.Color,
        // ... –≤—Å–µ –ø–æ–ª—è
    }
    metadata := map[string]interface{}{
        "workspace_id": workspaceID.String(),
    }
    r.CreateHistory(ctx, habitID, userID, "CREATED", changes, metadata)
    
    return &habit, nil
}

// –í –º–µ—Ç–æ–¥–µ Update:
func (r *Repository) Update(ctx context.Context, id, userID uuid.UUID, dto model.UpdateHabitDto) (*model.Habit, error) {
    // –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
    oldHabit, _ := r.Get(ctx, id, userID)
    
    // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    
    // –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
    changes := make(map[string]interface{})
    if dto.Title != nil && *dto.Title != oldHabit.Title {
        changes["title"] = map[string]string{
            "old": oldHabit.Title,
            "new": *dto.Title,
        }
    }
    // ... –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª–µ–π
    
    if len(changes) > 0 {
        r.CreateHistory(ctx, id, userID, "UPDATED", changes, nil)
    }
    
    return &habit, nil
}
```

**4. –î–æ–±–∞–≤–∏—Ç—å endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏:**
```go
// internal/handler/habits/handler.go
func (h *Handler) GetHistory(c *gin.Context) {
    // ... –≤–∞–ª–∏–¥–∞—Ü–∏—è
    
    history, err := h.service.GetHistory(c.Request.Context(), id, userID, workspaceID, 50)
    // ... –≤–æ–∑–≤—Ä–∞—Ç –∏—Å—Ç–æ—Ä–∏–∏
}
```

#### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ PostgreSQL

**–°–æ–∑–¥–∞—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:**

```sql
-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
CREATE OR REPLACE FUNCTION log_habit_changes()
RETURNS TRIGGER AS $$
DECLARE
    changes_json JSONB := '{}';
BEGIN
    IF TG_OP = 'INSERT' THEN
        INSERT INTO habit_history (id, habit_id, user_id, action, changes, created_at)
        VALUES (
            gen_random_uuid(),
            NEW.id,
            NEW.user_id,
            'CREATED',
            jsonb_build_object(
                'title', NEW.title,
                'color', NEW.color,
                'target_days', NEW.target_days
            ),
            NOW()
        );
        RETURN NEW;
    ELSIF TG_OP = 'UPDATE' THEN
        -- –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å—Ç–∞—Ä—ã–µ –∏ –Ω–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
        IF OLD.title IS DISTINCT FROM NEW.title THEN
            changes_json := changes_json || jsonb_build_object('title', jsonb_build_object('old', OLD.title, 'new', NEW.title));
        END IF;
        IF OLD.color IS DISTINCT FROM NEW.color THEN
            changes_json := changes_json || jsonb_build_object('color', jsonb_build_object('old', OLD.color, 'new', NEW.color));
        END IF;
        -- ... –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª–µ–π
        
        IF changes_json != '{}' THEN
            INSERT INTO habit_history (id, habit_id, user_id, action, changes, created_at)
            VALUES (
                gen_random_uuid(),
                NEW.id,
                NEW.user_id,
                'UPDATED',
                changes_json,
                NOW()
            );
        END IF;
        RETURN NEW;
    ELSIF TG_OP = 'DELETE' THEN
        INSERT INTO habit_history (id, habit_id, user_id, action, changes, created_at)
        VALUES (
            gen_random_uuid(),
            OLD.id,
            OLD.user_id,
            'DELETED',
            jsonb_build_object(
                'title', OLD.title,
                'deleted_at', NOW()
            ),
            NOW()
        );
        RETURN OLD;
    END IF;
    RETURN NULL;
END;
$$ LANGUAGE plpgsql;

-- –°–æ–∑–¥–∞—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä
CREATE TRIGGER habit_changes_trigger
    AFTER INSERT OR UPDATE OR DELETE ON habits
    FOR EACH ROW
    EXECUTE FUNCTION log_habit_changes();
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω—è—Ç—å –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ùå –°–ª–æ–∂–Ω–µ–µ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å
- ‚ùå –ú–µ–Ω—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ —Ñ–æ—Ä–º–∞—Ç–æ–º –¥–∞–Ω–Ω—ã—Ö
- ‚ùå –°–ª–æ–∂–Ω–µ–µ –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (IP, user agent)

---

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –í–∞—Ä–∏–∞–Ω—Ç 1 (—Ç–∞–±–ª–∏—Ü–∞ + –∫–æ–¥)**, –ø–æ—Ç–æ–º—É —á—Ç–æ:
1. –ë–æ–ª—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ —Ñ–æ—Ä–º–∞—Ç–æ–º –¥–∞–Ω–Ω—ã—Ö
2. –õ–µ–≥—á–µ –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (IP, user agent –∏–∑ HTTP –∑–∞–ø—Ä–æ—Å–∞)
3. –õ–µ–≥—á–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
4. –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)

---

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é

### 1. –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–∏

**–¢–µ–∫—É—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç –∫ –æ–¥–Ω–æ–π –ë–î
- –ù–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- –ù–µ—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏

#### –†–µ—à–µ–Ω–∏—è

**A. –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –ë–î (Master-Slave):**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Master DB  ‚îÇ ‚Üê –ó–∞–ø–∏—Å—å (INSERT, UPDATE, DELETE)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ              ‚îÇ
       ‚ñº              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇSlave DB 1‚îÇ    ‚îÇSlave DB 2‚îÇ ‚Üê –ß—Ç–µ–Ω–∏–µ (SELECT)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ:**
```go
type Repository struct {
    masterDB *sql.DB  // –¥–ª—è –∑–∞–ø–∏—Å–∏
    slaveDB  *sql.DB  // –¥–ª—è —á—Ç–µ–Ω–∏—è
}

func (r *Repository) List(ctx context.Context, ...) {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º slave –¥–ª—è —á—Ç–µ–Ω–∏—è
    rows, err := r.slaveDB.QueryContext(ctx, query, ...)
}

func (r *Repository) Create(ctx context.Context, ...) {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º master –¥–ª—è –∑–∞–ø–∏—Å–∏
    err := r.masterDB.QueryRowContext(ctx, query, ...)
}
```

**B. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (Redis):**
```go
// –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–∏–≤—ã—á–µ–∫ –Ω–∞ 5 –º–∏–Ω—É—Ç
func (r *Repository) List(ctx context.Context, userID, workspaceID uuid.UUID) ([]model.Habit, error) {
    cacheKey := fmt.Sprintf("habits:%s:%s", userID, workspaceID)
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
    cached, err := r.cache.Get(ctx, cacheKey)
    if err == nil {
        var habits []model.Habit
        json.Unmarshal([]byte(cached), &habits)
        return habits, nil
    }
    
    // –ï—Å–ª–∏ –Ω–µ—Ç –≤ –∫—ç—à–µ - –∑–∞–ø—Ä–æ—Å –∫ –ë–î
    habits, err := r.db.QueryContext(ctx, query, ...)
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à
    data, _ := json.Marshal(habits)
    r.cache.Set(ctx, cacheKey, data, 5*time.Minute)
    
    return habits, nil
}
```

---

### 2. –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

**A. –ò–Ω–¥–µ–∫—Å—ã (—É–∂–µ –µ—Å—Ç—å, –Ω–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å):**
```sql
-- –°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å –¥–ª—è —á–∞—Å—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
CREATE INDEX idx_habits_user_workspace_created 
ON habits(user_id, workspace_id, created_at DESC);

-- –ü–æ–∫—Ä—ã–≤–∞—é—â–∏–π –∏–Ω–¥–µ–∫—Å (covering index) - —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è
CREATE INDEX idx_habits_list_covering 
ON habits(user_id, workspace_id) 
INCLUDE (id, title, color, icon, created_at);
```

**B. –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `habit_completions`:**
```sql
-- –†–∞–∑–¥–µ–ª–∏—Ç—å –ø–æ –¥–∞—Ç–∞–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ –º–µ—Å—è—Ü–∞–º)
CREATE TABLE habit_completions_2026_01 
PARTITION OF habit_completions
FOR VALUES FROM ('2026-01-01') TO ('2026-02-01');

CREATE TABLE habit_completions_2026_02 
PARTITION OF habit_completions
FOR VALUES FROM ('2026-02-01') TO ('2026-03-01');
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ë—ã—Å—Ç—Ä–µ–µ –∑–∞–ø—Ä–æ—Å—ã (–º–µ–Ω—å—à–µ –¥–∞–Ω–Ω—ã—Ö –≤ –∫–∞–∂–¥–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏)
- –õ–µ–≥—á–µ —É–¥–∞–ª—è—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ (DROP –ø–∞—Ä—Ç–∏—Ü–∏—é)

---

### 3. –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

#### –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–∏—Å—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  API Gateway    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ         ‚îÇ          ‚îÇ          ‚îÇ
    ‚ñº         ‚ñº          ‚ñº          ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Habits ‚îÇ ‚îÇ Users  ‚îÇ ‚îÇWorkspace‚îÇ ‚îÇActivity‚îÇ
‚îÇService ‚îÇ ‚îÇService ‚îÇ ‚îÇ Service ‚îÇ ‚îÇService ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ         ‚îÇ          ‚îÇ          ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚îÇ
              ‚ñº
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇDatabase  ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–°–µ—Ä–≤–∏—Å Habits:**
- –û—Ç–≤–µ—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∑–∞ –ø—Ä–∏–≤—ã—á–∫–∏
- –ò–º–µ–µ—Ç —Å–≤–æ—é –ë–î –∏–ª–∏ —Å—Ö–µ–º—É
- –û–±—â–∞–µ—Ç—Å—è —Å –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ —á–µ—Ä–µ–∑ API

**–°–µ—Ä–≤–∏—Å Activity (–¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏):**
- –•—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
- –ú–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
- –ü–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –æ—Ç –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

---

### 4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è RecentActivityWidget

**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:**
- –í–∏–¥–∂–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–∞–≥–ª—É—à–∫—É
- –ù–µ—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ–± –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

**–†–µ—à–µ–Ω–∏–µ:**

**A. –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:**
```sql
CREATE TABLE activities (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    workspace_id UUID NOT NULL REFERENCES workspaces(id) ON DELETE CASCADE,
    
    -- –¢–∏–ø –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    type VARCHAR(50) NOT NULL,  -- 'HABIT_CREATED', 'HABIT_COMPLETED', 'HABIT_UPDATED'
    
    -- –°—Å—ã–ª–∫–∞ –Ω–∞ —Å—É—â–Ω–æ—Å—Ç—å
    entity_type VARCHAR(50) NOT NULL,  -- 'habit', 'completion'
    entity_id UUID NOT NULL,
    
    -- –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    title VARCHAR(255) NOT NULL,  -- '–ó–∞–≤–µ—Ä—à–µ–Ω–∞ –ø—Ä–∏–≤—ã—á–∫–∞ "–ß—Ç–µ–Ω–∏–µ"'
    emoji VARCHAR(10),            -- '‚úÖ'
    
    created_at TIMESTAMP NOT NULL DEFAULT NOW()
);

CREATE INDEX idx_activities_user_workspace_created 
ON activities(user_id, workspace_id, created_at DESC);
```

**B. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã:**
```go
// internal/repository/activities/repository.go
func (r *Repository) CreateActivity(ctx context.Context, userID, workspaceID uuid.UUID, activityType, entityType string, entityID uuid.UUID, title, emoji string) error {
    // ...
}

func (r *Repository) GetRecentActivities(ctx context.Context, userID, workspaceID uuid.UUID, limit int) ([]model.Activity, error) {
    query := `
        SELECT id, type, entity_type, entity_id, title, emoji, created_at
        FROM activities
        WHERE user_id = $1 AND workspace_id = $2
        ORDER BY created_at DESC
        LIMIT $3
    `
    // ...
}
```

**C. –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã Habits:**
```go
// –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–∏–≤—ã—á–∫–∏:
func (r *Repository) Create(ctx context.Context, ...) {
    // ... —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏
    
    // –°–æ–∑–¥–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
    activitiesRepo.CreateActivity(ctx, userID, workspaceID, 
        "HABIT_CREATED", "habit", habitID, 
        fmt.Sprintf("–°–æ–∑–¥–∞–Ω–∞ –ø—Ä–∏–≤—ã—á–∫–∞ \"%s\"", dto.Title), "‚ûï")
}

// –ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø—Ä–∏–≤—ã—á–∫–∏:
func (r *Repository) Complete(ctx context.Context, ...) {
    // ... —Å–æ–∑–¥–∞–Ω–∏–µ completion
    
    // –ü–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏
    habit, _ := r.Get(ctx, habitID, userID)
    
    // –°–æ–∑–¥–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
    activitiesRepo.CreateActivity(ctx, userID, workspaceID,
        "HABIT_COMPLETED", "completion", completionID,
        fmt.Sprintf("–ó–∞–≤–µ—Ä—à–µ–Ω–∞ –ø—Ä–∏–≤—ã—á–∫–∞ \"%s\"", habit.Title), "‚úÖ")
}
```

**D. –û–±–Ω–æ–≤–∏—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥:**
```typescript
// frontend/src/widgets/activity/ui/RecentActivityWidget.vue
onMounted(async () => {
  const response = await api.get(`/api/activities?workspace_id=${workspaceId}&limit=10`)
  activities.value = response.data.activities.map(activity => ({
    id: activity.id,
    emoji: activity.emoji,
    title: activity.title,
    time: formatTimeAgo(activity.createdAt) // "2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥"
  }))
})
```

---

### 5. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**A. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:**
```go
func (r *Repository) List(ctx context.Context, ...) {
    start := time.Now()
    rows, err := r.db.QueryContext(ctx, query, ...)
    duration := time.Since(start)
    
    if duration > 100*time.Millisecond {
        log.Printf("SLOW QUERY: List habits took %v", duration)
    }
}
```

**B. –ú–µ—Ç—Ä–∏–∫–∏:**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- –†–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤

**C. –ê–ª–µ—Ä—Ç—ã:**
- –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è > 1 —Å–µ–∫—É–Ω–¥—ã
- –ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ habits > 1M –∑–∞–ø–∏—Å–µ–π
- –ï—Å–ª–∏ –∏–Ω–¥–µ–∫—Å –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

---

## üìö –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (1-2 –Ω–µ–¥–µ–ª–∏)
1. ‚úÖ –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `habit_history` –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏—Å—Ç–æ—Ä–∏–µ–π
3. ‚úÖ –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `activities` –¥–ª—è –≤–∏–¥–∂–µ—Ç–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
4. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å endpoint `/api/activities`

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ (1-2 –º–µ—Å—è—Ü–∞)
1. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (Redis) –¥–ª—è —Å–ø–∏—Å–∫–∞ –ø—Ä–∏–≤—ã—á–µ–∫
2. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è `habit_completions`
4. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é –ë–î (master-slave)

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ (3-6 –º–µ—Å—è—Ü–µ–≤)
1. ‚úÖ –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
3. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ –ø—Ä–∏–≤—ã—á–∫–∞–º
4. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É –∏ –¥–∞—à–±–æ—Ä–¥—ã

---

## üîç –ì–ª–æ—Å—Å–∞—Ä–∏–π

- **Foreign Key (FK)** - –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á, —Å–≤—è–∑—å –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏
- **CASCADE** - –∫–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ, –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –∑–∞–ø–∏—Å–∏ —É–¥–∞–ª—è—é—Ç—Å—è –¥–æ—á–µ—Ä–Ω–∏–µ
- **Index** - –∏–Ω–¥–µ–∫—Å, —É—Å–∫–æ—Ä—è–µ—Ç –ø–æ–∏—Å–∫ –ø–æ –ø–æ–ª—é
- **Transaction** - —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è, –∞—Ç–æ–º–∞—Ä–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è (–≤—Å–µ –∏–ª–∏ –Ω–∏—á–µ–≥–æ)
- **Trigger** - —Ç—Ä–∏–≥–≥–µ—Ä, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ–º–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- **UUID** - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä (128 –±–∏—Ç)
- **JSONB** - –±–∏–Ω–∞—Ä–Ω—ã–π JSON –≤ PostgreSQL, –±—ã—Å—Ç—Ä–µ–µ –æ–±—ã—á–Ω–æ–≥–æ JSON

---

**–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω:** 2026-01-23  
**–í–µ—Ä—Å–∏—è:** 1.0
