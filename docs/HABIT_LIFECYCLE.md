# Жизненный цикл привычки

## Обзор

Этот документ описывает, как работает система привычек в приложении: от создания до отслеживания прогресса.

## 1. Создание привычки

### Процесс создания
1. Пользователь нажимает "Создать привычку"
2. Заполняет форму:
   - **Название** (обязательно, до 50 символов)
   - **Описание** (необязательно, до 200 символов)
   - **Цвет** (для визуального отличия)
   - **Иконка** (эмодзи для быстрого распознавания)
   - **Цель на день** (сколько раз нужно выполнить, от 1 до 10)
   - **Предпочтительное время** (утро/день/вечер/любое)
   - **Категория** (здоровье/спорт/учеба/работа/личное)

### После создания
- Привычка **сразу становится активной** и начинает отслеживаться
- Нет периода "подготовки" - привычка живет постоянно, пока не будет удалена
- Привычка привязана к текущему workspace пользователя

## 2. Жизнь привычки

### Активность
- Привычка **активна всегда** после создания
- Нет понятия "период соблюдения" - привычка работает бессрочно
- Можно редактировать или удалить в любой момент

### Ежедневный цикл
- Каждый день пользователь может отмечать выполнение привычки
- Количество выполнений в день = количество отметок (может быть больше цели)
- Прогресс сбрасывается каждый день (но история сохраняется)

## 3. Отметка выполнения

### Что происходит при отметке
1. Открывается модальное окно `MarkCompletionModal`
2. Пользователь указывает:
   - **Сколько раз выполнили** (1-5 раз)
   - **Время выполнения** (опционально)
   - **Заметку** (опционально)
   - **Чувство после выполнения** (опционально)

3. При подтверждении:
   - Создается **N записей** в базе данных (где N = количество раз)
   - Каждая запись = одно выполнение привычки
   - Все записи привязаны к текущей дате
   - Данные сохраняются: дата, время, заметка, рейтинг (из чувства)

### Важно
- Можно отметить выполнение **несколько раз в день**
- Каждая отметка увеличивает счетчик выполнений за день
- Если цель = 3 раза, можно отметить 1, 2 или 3 раза за один раз

### Toggle vs MarkCompletion

**Toggle** (переключение) - устаревший метод, который:
- ❌ Создает или удаляет только **одну** запись completion
- ❌ Не учитывает `dailyGoal` (цель на день)
- ❌ Сбрасывает все предыдущие отметки при переключении
- ❌ Не подходит для привычек с целью > 1 раза в день

**MarkCompletion** (отметка выполнения) - правильный метод:
- ✅ Создает **несколько** записей (по количеству выполнений)
- ✅ Учитывает `dailyGoal` и прогресс
- ✅ Сохраняет все предыдущие отметки
- ✅ Подходит для любых привычек

**Рекомендация:** Используйте только `markCompletion`. Toggle оставлен для обратной совместимости, но не рекомендуется к использованию.

## 4. Прогресс и статистика

### Прогресс сегодня
- **Счетчик**: сколько раз отмечено выполнение сегодня
- **Цель**: сколько раз нужно выполнить (dailyGoal)
- **Процент**: (выполнено / цель) * 100%
- **Статус**: достигнута ли цель на сегодня

### Общая статистика
- **Всего выполнений**: общее количество всех отметок за все время
- **Дней с выполнениями**: количество уникальных дней, когда была хотя бы одна отметка
- **Текущая серия (стрик)**: сколько дней подряд выполнялась привычка (до сегодня включительно)
- **Лучшая серия**: максимальная последовательность дней подряд

### Как считаются стрики
- **Текущий стрик**: идем от сегодня назад, считаем дни подряд с выполнениями
- Если сегодня выполнено → стрик начинается с сегодня
- Если сегодня не выполнено → стрик = 0
- **Лучший стрик**: ищем самую длинную последовательность дней в истории

## 5. Несколько привычек

### Календарь
- Все привычки отображаются в общем календаре
- Каждый день показывает, какие привычки выполнены
- Цвета привычек помогают визуально различать их

### Статистика по всем привычкам
- На главной странице видно общий прогресс
- Можно фильтровать по категориям
- Каждая привычка имеет свою статистику

## 6. Карточка привычки

### Что отображается
1. **Основная информация**:
   - Иконка и цвет
   - Название и описание
   - Категория и цель на день
   - Предпочтительное время

2. **Статистика сегодня**:
   - Выполнено X из Y раз
   - Прогресс-бар с процентом
   - Статус достижения цели

3. **Общая статистика**:
   - Всего выполнений
   - Дней с выполнениями
   - Текущая серия
   - Лучшая серия

4. **История выполнений**:
   - Последние 5 выполнений
   - Дата, время, заметка, рейтинг

## 7. Что делать с прогрессом

### Прогресс сегодня
- **Использование**: видеть, достигнута ли цель на сегодня
- **Действие**: если не достигнута, отметить выполнение
- **Мотивация**: визуальный прогресс-бар показывает, насколько близко к цели

### Общая статистика
- **Использование**: отслеживать долгосрочный прогресс
- **Мотивация**: стрики показывают последовательность
- **Анализ**: видеть, сколько дней реально были с выполнениями

## 8. Примеры использования

### Пример 1: Утренняя зарядка
- **Цель**: 1 раз в день
- **Отметка**: каждый день утром отмечаю выполнение
- **Стрик**: если пропустил день → стрик сбрасывается
- **Статистика**: показывает, сколько дней подряд делал зарядку

### Пример 2: Пить воду
- **Цель**: 8 раз в день
- **Отметка**: отмечаю каждый раз, когда выпил стакан
- **Прогресс**: вижу, сколько уже выпил сегодня (например, 5/8)
- **Статистика**: общее количество выпитых стаканов за все время

### Пример 3: Чтение
- **Цель**: 1 раз в день
- **Отметка**: отмечаю после прочтения, добавляю заметку о прочитанном
- **История**: вижу все дни, когда читал, и свои заметки
- **Стрик**: мотивирует не пропускать дни

## 9. Технические детали

### Модель данных
- **Habit**: основная информация о привычке
- **HabitCompletion**: запись о выполнении (дата, время, заметка, рейтинг)
- **HabitStats**: статистика (стрики, проценты, количество)

### API endpoints
- `GET /habits` - список всех привычек
- `POST /habits` - создать привычку
- `POST /habits/:id/complete` - отметить выполнение
- `GET /habits/:id/stats` - получить статистику
- `GET /habits/completions?habit_id=...` - получить историю выполнений

### Хранение данных
- Completions загружаются за последние 90 дней
- Статистика рассчитывается на основе completions
- Стрики вычисляются на клиенте из массива completions

## 10. Часто задаваемые вопросы

**Q: Привычка активна всегда?**
A: Да, после создания привычка активна постоянно, пока не будет удалена.

**Q: Можно ли отметить выполнение несколько раз в день?**
A: Да, можно отметить любое количество раз. Каждая отметка увеличивает счетчик.

**Q: Что если я пропущу день?**
A: Стрик сбросится, но история выполнений сохранится. Можно продолжить на следующий день.

**Q: Как формируется статистика?**
A: На основе всех записей о выполнениях (HabitCompletion). Стрики рассчитываются из уникальных дат выполнения.

**Q: Можно ли редактировать прошлые отметки?**
A: Пока нет, но это можно добавить в будущем.

**Q: Что происходит при удалении привычки?**
A: Удаляется привычка и все связанные записи о выполнениях.
